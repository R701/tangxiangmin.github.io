<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <link rel="stylesheet" href="/css/blog.css">
    <link rel="stylesheet" href="/css/fonts/iconfont.css">
    <!--<link rel="stylesheet" href="//cdn.bootcss.com/highlight.js/9.2.0/styles/github.min.css">-->
    <link rel="stylesheet" href="//cdn.bootcss.com/fancybox/3.1.25/jquery.fancybox.min.css">
    <script src="/js/require.js" data-main="/js/main"></script>
</head>
<body>
<div id="blog" class="page page-theme-base" v-cloak>
    <blog-header></blog-header>
    <header class="page_hd" data-v-04342fbc="">
    <div class="container header" data-v-04342fbc="">
        <h1 class="logo" data-v-04342fbc="">
            <a href="/" class="nuxt-link-exact-active nuxt-link-active" data-v-04342fbc="">橙红年代</a>
        </h1>
        <div class="show-md" data-v-04342fbc="">
            <div class="btn-list" data-v-04342fbc="">
                <div class="btn-icon" data-v-04342fbc="">
                    <span class="btn-line" data-v-04342fbc=""></span>
                    <span class="btn-line" data-v-04342fbc=""></span>
                    <span class="btn-line" data-v-04342fbc=""></span>
                </div>
            </div>
        </div>
        <nav class="nav-responsive" data-v-04342fbc="">
            
            <a class="nav_item" href="/">首页</a>
            
            <a class="nav_item" href="/archives">归档</a>
            
            <a class="nav_item" href="/tags">标签</a>
            
        </nav>
    </div>
</header>
    <main class="page_mn" >
        <div class="container">
            <article class="article article-detail">
    <header class="text-center">
        <h2 class="article_hd">在JS中遇见的一些BUG</h2>
        <div class="article_info">
            <span class="hide-sm">发表于</span>
            <span class="show-sm">
                <i class="iconfont icon-archives"></i>
            </span>
            <time>2017/1/15 21:55:29</time>
            |
            <span class="hide-sm">分类于</span>
            <span class="show-sm"><i class="iconfont icon-tag"></i></span>
            
                <a href="/categories/JavaScript" class="hover-highlight">JavaScript</a>
            

        </div>
    </header>
    <div class="article_ct">
        <p>前面写了一篇记录遇见的CSS的BUG，这篇文章就用来整理和记录写JS遇见的坑。实际上项目基本上都使用了jQuery，因此绝大部分兼容性问题已经很少遇到了，然而，总还是有一些蛋疼的问题出现。</p>
<a id="more"></a>
<h2 id="兼容"><a href="#兼容" class="headerlink" title="兼容"></a>兼容</h2><h3 id="移动端获取触摸坐标"><a href="#移动端获取触摸坐标" class="headerlink" title="移动端获取触摸坐标"></a>移动端获取触摸坐标</h3><p>由于代码都是在PC端使用模拟器进行测试的，一到真机上就嗝屁了。最初写了一个滑动图片的demo，手机上查看死活没反应，最后发现并不能使用<code>e.pageX</code>和<code>e.pageY</code>获取，而是<code>var startPoint = e.originalEvent.targetTouches[0].pageX;</code>获取…这个怎么能叫BUG！！</p>
<h3 id="手指按住屏幕时UI，JS线程不会执行的"><a href="#手指按住屏幕时UI，JS线程不会执行的" class="headerlink" title="手指按住屏幕时UI，JS线程不会执行的"></a>手指按住屏幕时UI，JS线程不会执行的</h3><p>在IOS上发现的这个BUG，一个抢购倒计时，当手指按住屏幕的时候倒计时会暂停。<br>一通查询，这个问题貌似是JS执行线程，UI线程，事件线程之间的关系，办法就是使用事件线程来协调JS线程和UI线程，因为在JS执行的过程中如果触发了UI事件那么就会引起UI更新；<br>js中没有阻塞式的sleep。因为在浏览器中UI线程会随JS线程一起阻塞。如果JS阻塞了，界面也会失去响应，或者无法更新。<br>附原回答，这个问题我到现在都没有解决，（要不是今天整理笔记我都忘记这茬了）</p>
<ul>
<li><a href="https://www.zhihu.com/question/38337979" target="_blank" rel="external">问题1</a></li>
<li><a href="http://www.cnblogs.com/liuliang-wifi/p/5431726.html" target="_blank" rel="external">问题2</a></li>
</ul>
<h3 id="unbeforeunload不触发"><a href="#unbeforeunload不触发" class="headerlink" title="unbeforeunload不触发"></a>unbeforeunload不触发</h3><p>如果事件回调函数中存在报错，则窗口会直接关闭而不是在控制台显示错误并阻止程序执行。<br>因此很难发现unbeforeunload不触发的问题，需要仔细排查！</p>
<h3 id="touchstart之后的click事件不生效"><a href="#touchstart之后的click事件不生效" class="headerlink" title="touchstart之后的click事件不生效"></a>touchstart之后的click事件不生效</h3><p>在使用touchstart之后页面上的链接都点击不了（后来发现是在touchend中使用了return false，实际上是e.preventDefault()导致整个页面的链接都失效。这个就是自己给自己挖坑了。<br>附：<a href="http://www.cnblogs.com/lvmingyin/p/5372678.html" target="_blank" rel="external">问题1</a></p>
<h2 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h2><h3 id="字符串转数字"><a href="#字符串转数字" class="headerlink" title="字符串转数字"></a>字符串转数字</h3><p>之前写过的一端预约时间的的代码，采用的逻辑是根据后台传出的时间段及时间间隔，根据分数遍历出对应的option，但是360浏览器下的parseInt()有个很严重的BUG: <code>parseInt(&quot;01&quot;)</code>..<code>parseInt(&quot;07&quot;)</code>都会正确转换成1到7，但是<br><code>parseInt(&quot;08&quot;)</code>,<code>parseInt(&quot;09&quot;)</code>却转换成了0,这是一个十分严重的BUG,硬生生的将预约时间增加了数个小时<br>解决办法是在使用使用隐式转换与显式转换，即<code>parseInt(&quot;09&quot;-0)</code>，这样才能解决问题。</p>
<p>在阅读《JavaScript语言精粹》的时候终于知道了问题的缘由：parseInt()是一个把字符串转换成整数的函数，在遇见非数字时就会停止解析；然而如果第一个字符是0，则会默认按照八进制解析，由于8,9不是合法的八进制字符，因此会转换成0，产生了上面的BUG（在谷歌浏览器等先进浏览器下面已经解决了这个问题，因此没有发现这个问题）。解决办法是在使用parseInt的时候显式的指定第二个参数，即转换进制,parseInt(‘09’,10);</p>
<h3 id="函数返回true"><a href="#函数返回true" class="headerlink" title="函数返回true"></a>函数返回true</h3><p>一个函数如果没有返回值则默认返回undefined；因此在判断语句中使用return true和false时，需要显式地将return true声明，否则函数会一直返回false或者undefined。这是一个很简单的基础问题，我当时去花了半个多小时，真是醉了。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">function checkPhone(tel)&#123;</div><div class="line">    var re = /^1[358]&#123;1&#125;\d&#123;9&#125;$/;</div><div class="line">    if (!tel || !re.test(tel))&#123;</div><div class="line">        alert(&quot;请输入正确的手机号&quot;);</div><div class="line">        return false;</div><div class="line">    &#125;</div><div class="line">    return true;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>现在回过头看，明显应该修改判断条件，把<code>return true</code>写在判断里面，哎，想之前还写过<code>if {...} else { continue}</code>的代码呢。</p>
<h2 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h2><p>遇见的JS的问题还是比较少的，因为JS的代码写的比较少，也写的比较简陋，并且大部分问题都是前人碰见过的，总之，感谢互联网！</p>

    </div>
    <footer class="article_ft">
        
        <a href="/tags/Bugs" class="article_tag">#Bugs</a>
        
    </footer>

    <div class="article_nav"><a href="/article/mockjs使用心得" class="hover-highlight article_prev">mockjs使用心得</a><a
                href="/article/博客SSR实践总结" class="hover-highlight article_next">博客SSR实践总结</a></div>
</article>
        </div>
    </main>

    <aside>
    <div class="page_sd hide-md">
        <div class="tab">
            <!---->
            
            <ul class="tab_nav">
                <li class="tab_item active" data-target="#J_toc">
                    文章目录
                </li>
                <li class="tab_item" data-target="#J_profile">
                    站点资料
                </li>
            </ul>
            <div class="tab_panel active" id="J_toc">
                <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#兼容"><span class="toc-number">1.</span> <span class="toc-text">兼容</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#移动端获取触摸坐标"><span class="toc-number">1.1.</span> <span class="toc-text">移动端获取触摸坐标</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#手指按住屏幕时UI，JS线程不会执行的"><span class="toc-number">1.2.</span> <span class="toc-text">手指按住屏幕时UI，JS线程不会执行的</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#unbeforeunload不触发"><span class="toc-number">1.3.</span> <span class="toc-text">unbeforeunload不触发</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#touchstart之后的click事件不生效"><span class="toc-number">1.4.</span> <span class="toc-text">touchstart之后的click事件不生效</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#语法"><span class="toc-number">2.</span> <span class="toc-text">语法</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#字符串转数字"><span class="toc-number">2.1.</span> <span class="toc-text">字符串转数字</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#函数返回true"><span class="toc-number">2.2.</span> <span class="toc-text">函数返回true</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#小结"><span class="toc-number">3.</span> <span class="toc-text">小结</span></a></li></ol>
            </div>
            
            <div class="tab_panel " id="J_profile">
                <div>
                    <div class="me">
                        <img src="http://shymean.com/_nuxt/img/head.dd612ee.jpg" alt="shymean" width="100" height="100">
                        <h3>shymean</h3>
                        <p>一个不学无术且无趣的人。</p>
                    </div>
                    <div class="nav-border">
                        <a href="/book" class="nav_item">
                            <i class="iconfont icon-bookshelf"></i>
                            <br>书架
                        </a>
                        <a href="/message" class="nav_item">
                            <i class="iconfont icon-comment"></i>
                            <br>留言
                        </a>
                        <a href="/about" class="nav_item">
                            <i class="iconfont icon-info"></i>
                            <br>关于
                        </a>
                    </div>
                    <div class="contact">
                        <a href="https://github.com/tangxiangmin" target="_blank" class="contact_link">
                            <i class="iconfont icon-github"></i> GitHub</a>
                        <a href="http://wpa.qq.com/msgrd?v=3&amp;uin=645234650&amp;site=qq&amp;menu=yes"
                            target="_blank" class="contact_link">
                            <i class="iconfont icon-qq"></i> QQ</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="tool">
        <div class="btn-list hide-md" id="J_toggleSide">
            <div class="btn-icon">
                <span class="btn-line"></span>
                <span class="btn-line"></span>
                <span class="btn-line"></span>
            </div>
        </div>
        <div class="btn-top">
            <i class="iconfont icon-top"></i>
        </div>
    </div>
</aside>
    <footer class="page_ft">
    <div class="container footer">
        <p>世人的悲欢并不相通，我只是觉得他们吵闹。</p>
        <p>
            Copyright © Shymean 2016 - 2017
            <a href="http://www.miitbeian.gov.cn" rel="nofollow" target="_blank" style="display:inline-block;">粤ICP备17060238号-1</a>
        </p>
    </div>
    <div class="hide-xs">
        <script src="https://s19.cnzz.com/z_stat.php?id=1264491168&amp;web_id=1264491168" language="JavaScript"></script>
    </div>
</footer>

</div>

</body>
</html>