<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <link rel="stylesheet" href="/css/blog.css">
    <link rel="stylesheet" href="/css/fonts/iconfont.css">
    <!--<link rel="stylesheet" href="//cdn.bootcss.com/highlight.js/9.2.0/styles/github.min.css">-->
    <link rel="stylesheet" href="//cdn.bootcss.com/fancybox/3.1.25/jquery.fancybox.min.css">
    <script src="/js/require.js" data-main="/js/main"></script>
</head>
<body>
<div id="blog" class="page page-theme-base" v-cloak>
    <blog-header></blog-header>
    <header class="page_hd" data-v-04342fbc="">
    <div class="container header" data-v-04342fbc="">
        <h1 class="logo" data-v-04342fbc="">
            <a href="/" class="nuxt-link-exact-active nuxt-link-active" data-v-04342fbc="">橙红年代</a>
        </h1>
        <div class="show-md" data-v-04342fbc="">
            <div class="btn-list" data-v-04342fbc="">
                <div class="btn-icon" data-v-04342fbc="">
                    <span class="btn-line" data-v-04342fbc=""></span>
                    <span class="btn-line" data-v-04342fbc=""></span>
                    <span class="btn-line" data-v-04342fbc=""></span>
                </div>
            </div>
        </div>
        <nav class="nav-responsive" data-v-04342fbc="">
            
            <a class="nav_item" href="/">首页</a>
            
            <a class="nav_item" href="/archives">归档</a>
            
            <a class="nav_item" href="/tags">标签</a>
            
        </nav>
    </div>
</header>
    <main class="page_mn" >
        <div class="container">
            <article class="article article-detail">
    <header class="text-center">
        <h2 class="article_hd">Android小项目之笑话大全</h2>
        <div class="article_info">
            <span class="hide-sm">发表于</span>
            <span class="show-sm">
                <i class="iconfont icon-archives"></i>
            </span>
            <time>2017/9/10 23:39:11</time>
            |
            <span class="hide-sm">分类于</span>
            <span class="show-sm"><i class="iconfont icon-tag"></i></span>
            
                <a href="/categories/Android" class="hover-highlight">Android</a>
            

        </div>
    </header>
    <div class="article_ct">
        <p>陆陆续续学习Android开发也有一段时间了，总觉得应该写点东西练练手。这是尝试的第一个Demo，用到的技术点包括<code>Fragment</code>、<code>RecyclerView</code>、网络请求、UI更新等。</p>
<a id="more"></a>
<p>参考：</p>
<ul>
<li><a href="http://blog.csdn.net/qq_27376951/article/details/51810829" target="_blank" rel="external">Android中ImageView和ImageButton的比较详解</a></li>
<li><a href="http://www.cnblogs.com/whoislcj/p/5526431.html" target="_blank" rel="external">Android okHttp网络请求之Get/Post请求</a></li>
<li><a href="http://www.jianshu.com/p/e740196225a4" target="_blank" rel="external">你真的会用Gson吗?Gson使用指南</a></li>
<li><a href="http://www.cnblogs.com/jianyungsun/p/6647203.html" target="_blank" rel="external">用GSON 五招之内搞定任何JSON数组</a></li>
</ul>
<h2 id="活动与碎片管理"><a href="#活动与碎片管理" class="headerlink" title="活动与碎片管理"></a>活动与碎片管理</h2><h3 id="单碎片活动"><a href="#单碎片活动" class="headerlink" title="单碎片活动"></a>单碎片活动</h3><p>活动是Android的基础，碎片是基于活动之上的。这里参考《Android权威指南》采用的一个管理碎片的活动类<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">SingleFragmentActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">abstract</span> Fragment <span class="title">createFragment</span><span class="params">()</span></span>;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(@Nullable Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</div><div class="line"></div><div class="line">        <span class="comment">// 这个视图上只有一个用于存放碎片的容器，即R.id.fragment_container</span></div><div class="line">        setContentView(R.layout.activity_single_fragment);</div><div class="line">        getSupportActionBar().hide();</div><div class="line">		</div><div class="line">		<span class="comment">// 碎片管理器</span></div><div class="line">        FragmentManager fragmentManager = getSupportFragmentManager();</div><div class="line">        Fragment fragment = fragmentManager.findFragmentById(R.id.fragment_container);</div><div class="line"></div><div class="line">        <span class="keyword">if</span> (fragment == <span class="keyword">null</span>)&#123;</div><div class="line">            fragment = createFragment();</div><div class="line">            fragmentManager.beginTransaction().add(R.id.fragment_container, fragment).commit();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JokeListActivity</span> <span class="keyword">extends</span> <span class="title">SingleFragmentActivity</span> </span>&#123;</div><div class="line">	</div><div class="line">	<span class="comment">// 通过抽象，多个活动都可以实现这种单碎片的布局</span></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> Fragment <span class="title">createFragment</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">new</span> JokeListFragment();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="使用RecyclerView与滚动加载"><a href="#使用RecyclerView与滚动加载" class="headerlink" title="使用RecyclerView与滚动加载"></a>使用RecyclerView与滚动加载</h2><p><code>RecyclerView</code>可以很方便地管理列表项，这里通过<code>Android Studio</code>搜索<code>android.support.v7.widget.RecyclerView</code>并将其添加到项目中。<br><code>Recylerview</code>的任务仅限定于回收和定位屏幕上的view，为了能够显示条目view，还必须ViewHolder和Adapter的支持</p>
<ul>
<li>ViewHolder用于引用视图</li>
<li>Adapter用于为ViewHolder引用的视图提供数据，且ViewHolder实际上是由Adapter创建的</li>
</ul>
<h3 id="Holder"><a href="#Holder" class="headerlink" title="Holder"></a>Holder</h3><p>需要将<code>Holder</code>通过<code>LayoutInflater</code>关联到对应的布局上<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">private class JokeViewHolder extends RecyclerView.ViewHolder&#123;</div><div class="line">    public JokeViewHolder (LayoutInflater inflater, ViewGroup parent) &#123;</div><div class="line">    	// 准备好xml布局，R.layout.item_joke</div><div class="line">        super(inflater.inflate(R.layout.item_joke, parent, false));</div><div class="line">		</div><div class="line">		// 可以通过 itemView.findViewById 获取布局上的子组件</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    // 填充数据，JokeBean这个类后面会提到</div><div class="line">    public void bind(JokeBean joke)&#123;</div><div class="line">        mJoke = joke;</div><div class="line">        // 这里可以通过itemView自组件，然后将joke的属性内容填充到视图上</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="Adapter"><a href="#Adapter" class="headerlink" title="Adapter"></a>Adapter</h3><p><code>Adapter</code>用来绑定数据项<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">private class JokeAdapter extends RecyclerView.Adapter&lt;JokeViewHolder &gt;&#123;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public JokeViewHolder onCreateViewHolder(ViewGroup parent, int viewType) &#123;</div><div class="line">        LayoutInflater inflater = LayoutInflater.from(getActivity());</div><div class="line">        // 绑定 holder</div><div class="line">        return new JokeViewHolder (inflater, parent);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public void onBindViewHolder(JokeViewHolder holder, int position) &#123;</div><div class="line">    	// 获取单条数据</div><div class="line">        JokeBean joke = mJokes.get(position);</div><div class="line">        // 将数据传递到holder上</div><div class="line">        holder.bind(joke);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public int getItemCount() &#123;</div><div class="line">    	// 统计recyclerview的长度</div><div class="line">        return mJokes.size();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="设置"><a href="#设置" class="headerlink" title="设置"></a>设置</h3><p>完成了<code>Holder</code>和<code>Adapter</code>之后，只需要显式为recyclerview组件设置adapter即可<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">mAdapter = new JokeAdapter();</div><div class="line">mRv.setAdapter(mAdapter);</div></pre></td></tr></table></figure></p>
<p>考虑到数据会动态加载，<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">if (mAdapter == null)&#123;</div><div class="line">    mAdapter = new JokeAdapter();</div><div class="line">    mRv.setAdapter(mAdapter);</div><div class="line">&#125;else &#123;</div><div class="line">    mAdapter.notifyDataSetChanged();</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="网络请求与JSON解析"><a href="#网络请求与JSON解析" class="headerlink" title="网络请求与JSON解析"></a>网络请求与JSON解析</h2><p>在前面了解到了Android中网络请求的基本知识，这里使用<code>okHttp</code>进行网络请求，在本地使用<code>restify</code>搭建的服务器环境。</p>
<h3 id="请求"><a href="#请求" class="headerlink" title="请求"></a>请求</h3><p>使用<code>okHttp</code>发起请求十分简单（当然跟ajax没法比），这里可以对请求继续进一步封装，后面再折腾。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 实例化客户端</span></div><div class="line">OkHttpClient client = <span class="keyword">new</span> OkHttpClient();</div><div class="line"></div><div class="line"><span class="comment">// 构造请求</span></div><div class="line">Request request = <span class="keyword">new</span> Request.Builder()</div><div class="line">                .url(<span class="string">"http://10.0.2.2:9999/joke?page="</span>+page+<span class="string">"&amp;size=5"</span>)</div><div class="line">                .build();</div><div class="line"></div><div class="line"><span class="comment">// 异步发送请求</span></div><div class="line">client.newCall(request).enqueue(<span class="keyword">new</span> Callback() &#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onFailure</span><span class="params">(Call call, IOException e)</span> </span>&#123;</div><div class="line">        e.printStackTrace();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onResponse</span><span class="params">(Call call, Response response)</span> <span class="keyword">throws</span> IOException </span>&#123;</div><div class="line">      	</div><div class="line">      	<span class="comment">// 获取响应，这里服务端返回的是json字符串</span></div><div class="line">      	String res = response.body().string();</div><div class="line">      	<span class="comment">// todo: 解析数据</span></div><div class="line">    &#125;</div><div class="line">&#125;)</div></pre></td></tr></table></figure></p>
<p>拿到了数据之后，就需要考虑如何解析数据了，我们最终的目的是将内容展示到列表上。</p>
<h3 id="bean类"><a href="#bean类" class="headerlink" title="bean类"></a>bean类</h3><p>看人家的Android项目源码的时候，发现往往都有一个<code>bean</code>文件夹，存放只包含基本属性和对应<code>setter</code>与<code>getter</code>方法的数据类。一番查阅之后才发现这跟<a href="https://baike.baidu.com/item/javaBean/529577?fr=aladdin" target="_blank" rel="external">JavaBean</a>还有点关联~。<br>我对于Android中的bean类的理解就是将对象映射成对应的JSON形式，比如我们的joke数据返回是<br><figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">    <span class="attr">"title"</span>: <span class="string">"我：“唉，我们终究还..."</span>,</div><div class="line">    <span class="attr">"text"</span>: <span class="string">"我：“唉，我们终究还是败给了时间。。。。”\r\n基友：“说人话”\r\n我：“尼玛来不及做暑假作业了！！”"</span>,</div><div class="line">    <span class="attr">"type"</span>: <span class="number">1</span>,</div><div class="line">    <span class="attr">"ct"</span>: <span class="string">"2017-09-12 14:30:11.385"</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>对应的bean类是下面这个样子的，大概是我理解有误，这个貌似违背了封装的原则~<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">public class JokeBean &#123;</div><div class="line">    public String title;</div><div class="line">    public String text; // content</div><div class="line">    public int type;</div><div class="line">    public String ct; // created_time</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="Gson解析"><a href="#Gson解析" class="headerlink" title="Gson解析"></a>Gson解析</h3><p><code>Gson</code>是专门用来将Java对象与json对象相互转换的库，基础使用方法可以参考<a href="http://blog.csdn.net/qxs965266509/article/details/42774691" target="_blank" rel="external">Google Gson的使用方法,实现Json结构的相互转换</a>。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">Gson gson = new Gson();</div><div class="line">// JokeBean即对应的bean类</div><div class="line">ArrayList&lt;JokeBean&gt; jokes = new ArrayList&lt;JokeBean&gt;();</div><div class="line">JsonParser parser = new JsonParser();</div><div class="line"></div><div class="line">// res 即服务端返回的数据</div><div class="line">JsonArray arr = parser.parse(res).getAsJsonArray();</div><div class="line"></div><div class="line">for (JsonElement joke : arr)&#123;</div><div class="line">    JokeBean jokeBean = gson.fromJson(joke, JokeBean.class);</div><div class="line">    jokes.add(jokeBean);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="更新UI"><a href="#更新UI" class="headerlink" title="更新UI"></a>更新UI</h3><p>通过<code>Gson</code>我们得到了一个Java对象列表，接下来就是展示对应数据了。这里需要注意的问题就是如何在网络请求线程更新UI线程了。之前了解到可以通过<code>runOnUIThread</code>，<code>view.post</code>和<code>Handler</code>等方法，这里是使用<code>handler</code>进行处理的。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 定义handler</span></div><div class="line">mHandler = <span class="keyword">new</span> Handler()&#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleMessage</span><span class="params">(Message msg)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.handleMessage(msg);</div><div class="line"></div><div class="line">        <span class="keyword">switch</span> (msg.what)&#123;</div><div class="line">            <span class="keyword">case</span> <span class="number">0</span>:</div><div class="line">                List&lt;JokeBean&gt; jokes = (List&lt;JokeBean&gt;) msg.obj;</div><div class="line">                mJokes.addAll(jokes);</div><div class="line">				</div><div class="line">				<span class="comment">// 这里是recyclerview的适配器</span></div><div class="line">                mAdapter.notifyDataSetChanged();</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            <span class="keyword">default</span>:</div><div class="line">                Log.d(<span class="string">"txm"</span>, <span class="string">"handler default"</span>);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<p>在网络请求获取到数据并成功解析之后，通知handler<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">Message msg = <span class="keyword">new</span> Message();</div><div class="line">msg.obj = jokes;</div><div class="line">msg.what = <span class="number">0</span>;</div><div class="line"></div><div class="line">handler.sendMessage(msg);</div></pre></td></tr></table></figure></p>
<h2 id="自定义分享组件"><a href="#自定义分享组件" class="headerlink" title="自定义分享组件"></a>自定义分享组件</h2><p>由于分享是一个比较常见且通用的功能，因此我们可以将其进行封装（当然这里现在只是封装样式和基本操作，具体的分享功能需要接口实现）。</p>
<p>首先是定义布局，这里使用了一个<code>RelativeLayout</code>用于展示全屏的半透明背景，一个<code>GridLayout</code>摆放分享按钮<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">RelativeLayout</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></div><div class="line"><span class="tag">                <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></div><div class="line"><span class="tag">                <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></span></div><div class="line"><span class="tag">                <span class="attr">android:background</span>=<span class="string">"#80000000"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">GridLayout</span></span></div><div class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></div><div class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></div><div class="line"><span class="tag">        <span class="attr">android:layout_alignParentBottom</span>=<span class="string">"true"</span></span></div><div class="line"><span class="tag">        <span class="attr">android:background</span>=<span class="string">"#fff"</span></span></div><div class="line"><span class="tag">        <span class="attr">android:columnCount</span>=<span class="string">"3"</span></span></div><div class="line"><span class="tag">        <span class="attr">android:paddingBottom</span>=<span class="string">"10dp"</span></span></div><div class="line"><span class="tag">        <span class="attr">android:rowCount</span>=<span class="string">"2"</span>&gt;</span></div><div class="line"></div><div class="line">        <span class="tag">&lt;<span class="name">TextView</span></span></div><div class="line"><span class="tag">            <span class="attr">style</span>=<span class="string">"@style/share_btn"</span></span></div><div class="line"><span class="tag">            <span class="attr">android:background</span>=<span class="string">"@drawable/bg_qq"</span></span></div><div class="line"><span class="tag">            <span class="attr">android:text</span>=<span class="string">"QQ"</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">GridLayout</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">RelativeLayout</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>其中rgba颜色是通过额外增加十六进制颜色的前两位来实现的，上面的<code>80</code>代表<code>50%</code>的透明度，常用的透明度可以参考<a href="http://blog.csdn.net/github_25928675/article/details/50330635" target="_blank" rel="external">这里</a>。</p>
<p>然后去定义具体的视图类即可，在构造函数中加载布局，其他的操作比如点击按钮，隐藏分享界面等逻辑也可以在这里处理<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ShareLayout</span> <span class="keyword">extends</span> <span class="title">GridLayout</span> </span>&#123;</div><div class="line">	<span class="keyword">private</span> View mView;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ShareLayout</span><span class="params">(Context context, AttributeSet attrs)</span></span>&#123;</div><div class="line">        <span class="keyword">super</span>(context, attrs);</div><div class="line">        mView = LayoutInflater.from(context).inflate(R.layout.layout_share, <span class="keyword">this</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>最后就可以在其他地方使用这个自定义的组件了（真不好意思叫做自定义组件~）,记得设置<code>android:visibility=&quot;invisible&quot;</code>。<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">com.shymean.joke.view.ShareLayout</span></span></div><div class="line"><span class="tag">    <span class="attr">android:clickable</span>=<span class="string">"true"</span></span></div><div class="line"><span class="tag">    <span class="attr">android:id</span>=<span class="string">"@+id/share_wrap"</span></span></div><div class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></div><div class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></div><div class="line"><span class="tag">    <span class="attr">android:visibility</span>=<span class="string">"invisible"</span>/&gt;</span></div></pre></td></tr></table></figure></p>
<h3 id="阻止点击穿透"><a href="#阻止点击穿透" class="headerlink" title="阻止点击穿透"></a>阻止点击穿透</h3><p>完成布局之后，我们就可以通过<code>setVisibility(View.VISIBLE);</code>来控制整个组件的显示可隐藏了。但是发现即使分享弹出层覆盖了整个页面，仍旧可以滚动下面的<code>recyclerview</code>，也会触发滚动加载等事件，这就不太合理了。</p>
<p>我们知道在CSS中非静态定位的元素是有<code>Z-index</code>属性的，而高层级的元素会阻挡事件向被覆盖的底层级元素传递。<br>而在Android中，布局中的view是通过<code>addView</code>的顺序控制的，表现为写在xml布局文件靠后的组件会出现在上面</p>
<p>解决方案是：使用<code>FrameLayout</code>, 将<code>ShareLayout</code>放在后面，且添加上<code>android:clickable=&quot;true&quot;</code><br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">com.shymean.joke.view.ShareLayout</span></span></div><div class="line"><span class="tag">    <span class="attr">android:clickable</span>=<span class="string">"true"</span></span></div><div class="line"><span class="tag">    <span class="attr">android:id</span>=<span class="string">"@+id/share_wrap"</span></span></div><div class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></div><div class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></div><div class="line"><span class="tag">    <span class="attr">android:visibility</span>=<span class="string">"invisible"</span>/&gt;</span></div></pre></td></tr></table></figure></p>
<h3 id="向布局中动态添加视图"><a href="#向布局中动态添加视图" class="headerlink" title="向布局中动态添加视图"></a>向布局中动态添加视图</h3><p>预先向布局文件中引入组件显得比较死板，试想如果多个页面上都需要进行分享操作，那还不得在每个布局文件中都引入一次？因此需要找到动态向页面插入组件的方法，参考<a href="https://www.2cto.com/kf/201409/337088.html" target="_blank" rel="external">这里</a>。</p>
<p>实际上动态添加组件十分简单，使用<code>addView</code>即可<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">// 同时移除布局中的 com.shymean.joke.view.ShareLayout 标签</div><div class="line">// mShareLayout = (ShareLayout) v.findViewById(R.id.share_wrap);</div><div class="line"></div><div class="line">// 实例一个组件</div><div class="line">mShareLayout = new ShareLayout(getContext(), null);</div><div class="line">mShareLayout.setVisibility(View.INVISIBLE);</div><div class="line"></div><div class="line">// 找到根节点</div><div class="line">mRoot = (FrameLayout) v.findViewById(R.id.view_container);</div><div class="line">// 向根结点插入组件</div><div class="line">mRoot.addView(mShareLayout);</div></pre></td></tr></table></figure></p>
<p>另外还可以通过<code>removeView</code>移除组件，这里跟DOM操作基本类似。</p>
<h2 id="SQLite与本地存储"><a href="#SQLite与本地存储" class="headerlink" title="SQLite与本地存储"></a>SQLite与本地存储</h2><p>前面我们添加了一个收藏的按钮，可以将喜欢的笑话保存在SQLite中。这在<a href="/article/安卓入门之本地存储">安卓入门之本地存储</a>中也提到过，这里算是活学活用了。</p>
<h3 id="建立Schema"><a href="#建立Schema" class="headerlink" title="建立Schema"></a>建立Schema</h3><p>通过建立<code>Schema</code>来管理表名和字段，减少后续代码中的硬编码是十分必要的，这个看起来跟<code>bean</code>类比较相似<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JokeDbSchema</span> </span>&#123;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">JokeTable</span> </span>&#123;</div><div class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String NAME = <span class="string">"joke"</span>;</div><div class="line"></div><div class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">Cols</span> </span>&#123;</div><div class="line">            <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String TITLE = <span class="string">"title"</span>;</div><div class="line">            <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String CONTENT = <span class="string">"content"</span>;</div><div class="line">            <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String TYPE = <span class="string">"type"</span>;</div><div class="line">            <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String CREATED_AT = <span class="string">"created_at"</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="建立DBHelper类"><a href="#建立DBHelper类" class="headerlink" title="建立DBHelper类"></a>建立DBHelper类</h3><p>通过继承<code>SQLiteOpenHelper</code>来创建数据库及管理数据库版本<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">public class JokeDataBaseHelper extends SQLiteOpenHelper &#123;</div><div class="line">    private static final int VERSION = 1;</div><div class="line">    private static final String DATABASE_NAME = &quot;jokeBase.db&quot;;</div><div class="line">	</div><div class="line">	// 需要手动实现一个构造方法</div><div class="line">    public JokeDataBaseHelper(Context context)&#123;</div><div class="line">        super(context, DATABASE_NAME, null, VERSION);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public void onCreate(SQLiteDatabase db) &#123;</div><div class="line">    	// 这里用到了前面的schema</div><div class="line">        db.execSQL(&quot;create table &quot; + JokeTable.NAME + &quot;(&quot;  +</div><div class="line">                &quot;_id integer primary key autoincrement, &quot;+&quot;&quot; +</div><div class="line">                JokeTable.Cols.TITLE + &quot;, &quot; +</div><div class="line">                JokeTable.Cols.TYPE + &quot;, &quot; +</div><div class="line">                JokeTable.Cols.CONTENT + &quot;, &quot; +</div><div class="line">                JokeTable.Cols.CREATED_AT +&quot;)&quot;</div><div class="line">        );</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public void onUpgrade(SQLiteDatabase db, int oldVersion, int newVersion) &#123;</div><div class="line"></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>在开发的时候，数据结构改动可能比较大，如果频繁的去维护数据库会比较麻烦，这里建议直接从模拟器删除APP然后重新编译安装即可，所以这里的<code>onUpgrade</code>是空的。</p>
<p>可以通过<code>adb shell</code>去查看对应的数据库，记得修改权限啥的，这些坑在前面也已经趟过了。</p>
<h3 id="使用数据库"><a href="#使用数据库" class="headerlink" title="使用数据库"></a>使用数据库</h3><p>数据库创建之后，就可以通过<code>getWritableDatabase</code>获取到对应的数据库实例，然后进行<code>CURD</code>操作了。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mBd = <span class="keyword">new</span> JokeDataBaseHelper(getContext()).getWritableDatabase();</div></pre></td></tr></table></figure>
<p>这里只展示了点赞将数据插入到数据库中的操作，其他的就不写了，篇幅有点长了。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addItem</span><span class="params">(JokeBean joke)</span></span>&#123;</div><div class="line">	ContentValues values = <span class="keyword">new</span> ContentValues();</div><div class="line"></div><div class="line">	values.put(<span class="string">"title"</span>, joke.title);</div><div class="line">	values.put(<span class="string">"content"</span>, joke.text);</div><div class="line">	values.put(<span class="string">"type"</span>, joke.type);</div><div class="line">	values.put(<span class="string">"created_at"</span>, joke.ct);</div><div class="line">	Toast.makeText(getContext(), <span class="string">"succsss"</span>, Toast.LENGTH_SHORT).show();</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h2><h3 id="遇见的问题"><a href="#遇见的问题" class="headerlink" title="遇见的问题"></a>遇见的问题</h3><ul>
<li>为<code>RecyclerView</code>添加滚动事件时使用<code>addOnScrollListener</code>代替<code>setOnScrollListener</code></li>
<li>点赞图片使用的<code>selector</code>背景，默认状态需要放在所有item最后，否则看不见效果，参考<a href="https://stackoverflow.com/questions/7611498/android-setselected-and-state-selected" target="_blank" rel="external">stackoverflow</a></li>
<li>之前为了防止背景图片变形一直采用<code>bitmap</code>，直到我发现了<code>drawableTop</code>等属性~~</li>
<li>在<code>RadioGroup</code>布局中为某个<code>RadioButton</code>设置了<code>checked=true</code>属性之后，会出现同时选中两个radio的问题~~于是只能通过代码去实现默认选中</li>
</ul>
<h3 id="最后"><a href="#最后" class="headerlink" title="最后"></a>最后</h3><p>最近工作的事儿比较多，这个项目基本上是每天早晨和晚上抽空写一点儿，所以感觉不是很连贯。回想最初学Android的目的，是为了更深入的了解组件化开发，这确实是学到了一些东西，基本上用人家已经写好的轮子，就可以搭一个不错的APP，封装内部实现，对外部提供接口，不论是在Web开发还是在Android中，这些概念貌似都是通用的，无非是采用的语言不同，技术栈不同而已。</p>
<p>当然，后面还会继续学习Android开发，这里只是提醒自己，不要被别人已经写好的各式各样酷炫的组件所迷惑了，如果是工作，用成熟的框架是明智之选；如果是学习，了解原理貌似更重要一点，这点千万不能本末倒置了。说道框架，我不信Android框架有web前端的框架多~~~这是要打架的。</p>

    </div>
    <footer class="article_ft">
        
        <a href="/tags/demo" class="article_tag">#demo</a>
        
    </footer>

    <div class="article_nav"><a href="/article/mockjs使用心得" class="hover-highlight article_prev">mockjs使用心得</a><a
                href="/article/博客SSR实践总结" class="hover-highlight article_next">博客SSR实践总结</a></div>
</article>
        </div>
    </main>

    <aside>
    <div class="page_sd hide-md">
        <div class="tab">
            <!---->
            
            <ul class="tab_nav">
                <li class="tab_item active" data-target="#J_toc">
                    文章目录
                </li>
                <li class="tab_item" data-target="#J_profile">
                    站点资料
                </li>
            </ul>
            <div class="tab_panel active" id="J_toc">
                <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#活动与碎片管理"><span class="toc-number">1.</span> <span class="toc-text">活动与碎片管理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#单碎片活动"><span class="toc-number">1.1.</span> <span class="toc-text">单碎片活动</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#使用RecyclerView与滚动加载"><span class="toc-number">2.</span> <span class="toc-text">使用RecyclerView与滚动加载</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Holder"><span class="toc-number">2.1.</span> <span class="toc-text">Holder</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Adapter"><span class="toc-number">2.2.</span> <span class="toc-text">Adapter</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#设置"><span class="toc-number">2.3.</span> <span class="toc-text">设置</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#网络请求与JSON解析"><span class="toc-number">3.</span> <span class="toc-text">网络请求与JSON解析</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#请求"><span class="toc-number">3.1.</span> <span class="toc-text">请求</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#bean类"><span class="toc-number">3.2.</span> <span class="toc-text">bean类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Gson解析"><span class="toc-number">3.3.</span> <span class="toc-text">Gson解析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#更新UI"><span class="toc-number">3.4.</span> <span class="toc-text">更新UI</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#自定义分享组件"><span class="toc-number">4.</span> <span class="toc-text">自定义分享组件</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#阻止点击穿透"><span class="toc-number">4.1.</span> <span class="toc-text">阻止点击穿透</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#向布局中动态添加视图"><span class="toc-number">4.2.</span> <span class="toc-text">向布局中动态添加视图</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SQLite与本地存储"><span class="toc-number">5.</span> <span class="toc-text">SQLite与本地存储</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#建立Schema"><span class="toc-number">5.1.</span> <span class="toc-text">建立Schema</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#建立DBHelper类"><span class="toc-number">5.2.</span> <span class="toc-text">建立DBHelper类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#使用数据库"><span class="toc-number">5.3.</span> <span class="toc-text">使用数据库</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#小结"><span class="toc-number">6.</span> <span class="toc-text">小结</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#遇见的问题"><span class="toc-number">6.1.</span> <span class="toc-text">遇见的问题</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#最后"><span class="toc-number">6.2.</span> <span class="toc-text">最后</span></a></li></ol></li></ol>
            </div>
            
            <div class="tab_panel " id="J_profile">
                <div>
                    <div class="me">
                        <img src="http://shymean.com/_nuxt/img/head.dd612ee.jpg" alt="shymean" width="100" height="100">
                        <h3>shymean</h3>
                        <p>一个不学无术且无趣的人。</p>
                    </div>
                    <div class="nav-border">
                        <a href="/book" class="nav_item">
                            <i class="iconfont icon-bookshelf"></i>
                            <br>书架
                        </a>
                        <a href="/message" class="nav_item">
                            <i class="iconfont icon-comment"></i>
                            <br>留言
                        </a>
                        <a href="/about" class="nav_item">
                            <i class="iconfont icon-info"></i>
                            <br>关于
                        </a>
                    </div>
                    <div class="contact">
                        <a href="https://github.com/tangxiangmin" target="_blank" class="contact_link">
                            <i class="iconfont icon-github"></i> GitHub</a>
                        <a href="http://wpa.qq.com/msgrd?v=3&amp;uin=645234650&amp;site=qq&amp;menu=yes"
                            target="_blank" class="contact_link">
                            <i class="iconfont icon-qq"></i> QQ</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="tool">
        <div class="btn-list hide-md" id="J_toggleSide">
            <div class="btn-icon">
                <span class="btn-line"></span>
                <span class="btn-line"></span>
                <span class="btn-line"></span>
            </div>
        </div>
        <div class="btn-top">
            <i class="iconfont icon-top"></i>
        </div>
    </div>
</aside>
    <footer class="page_ft">
    <div class="container footer">
        <p>世人的悲欢并不相通，我只是觉得他们吵闹。</p>
        <p>
            Copyright © Shymean 2016 - 2017
            <a href="http://www.miitbeian.gov.cn" rel="nofollow" target="_blank" style="display:inline-block;">粤ICP备17060238号-1</a>
        </p>
    </div>
    <div class="hide-xs">
        <script src="https://s19.cnzz.com/z_stat.php?id=1264491168&amp;web_id=1264491168" language="JavaScript"></script>
    </div>
</footer>

</div>

</body>
</html>