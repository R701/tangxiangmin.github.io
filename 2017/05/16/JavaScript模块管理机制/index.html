<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <link rel="stylesheet" href="/css/blog.css">
    <link rel="stylesheet" href="/css/fonts/iconfont.css">
    <!--<link rel="stylesheet" href="//cdn.bootcss.com/highlight.js/9.2.0/styles/github.min.css">-->
    <link rel="stylesheet" href="//cdn.bootcss.com/fancybox/3.1.25/jquery.fancybox.min.css">
    <script src="/js/require.js" data-main="/js/main"></script>
</head>
<body>
<div id="blog" class="page page-theme-base" v-cloak>
    <blog-header></blog-header>
    <header class="page_hd" data-v-04342fbc="">
    <div class="container header" data-v-04342fbc="">
        <h1 class="logo" data-v-04342fbc="">
            <a href="/" class="nuxt-link-exact-active nuxt-link-active" data-v-04342fbc="">橙红年代</a>
        </h1>
        <div class="show-md" data-v-04342fbc="">
            <div class="btn-list" data-v-04342fbc="">
                <div class="btn-icon" data-v-04342fbc="">
                    <span class="btn-line" data-v-04342fbc=""></span>
                    <span class="btn-line" data-v-04342fbc=""></span>
                    <span class="btn-line" data-v-04342fbc=""></span>
                </div>
            </div>
        </div>
        <nav class="nav-responsive" data-v-04342fbc="">
            
            <a class="nav_item" href="/">首页</a>
            
            <a class="nav_item" href="/archives">归档</a>
            
            <a class="nav_item" href="/tags">标签</a>
            
        </nav>
    </div>
</header>
    <main class="page_mn" >
        <div class="container">
            <article class="article article-detail">
    <header class="text-center">
        <h2 class="article_hd">JavaScript模块管理机制</h2>
        <div class="article_info">
            <span class="hide-sm">发表于</span>
            <span class="show-sm">
                <i class="iconfont icon-archives"></i>
            </span>
            <time>2017/5/16 17:37:40</time>
            |
            <span class="hide-sm">分类于</span>
            <span class="show-sm"><i class="iconfont icon-tag"></i></span>
            
                <a href="/categories/JavaScript" class="hover-highlight">JavaScript</a>
            

        </div>
    </header>
    <div class="article_ct">
        <p>在之前的项目开发中一直使用<code>RequireJS</code>进行模块化管理，在<code>NodeJS</code>中使用的是<code>CommonJS</code>规范的模块管理，在<code>Vue-cli</code>中使用ES6内置的模块管理。恰好昨天面试题有一问提到他们之间的区别，之前并没有太深入这些知识，回答的不是很好，这里整理一下。</p>
<a id="more"></a>
<p>参考：</p>
<ul>
<li><a href="http://blog.csdn.net/Real_Bird/article/details/54869066" target="_blank" rel="external">javascript模块化之CommonJS、AMD、CMD、UMD、ES6</a></li>
<li><a href="http://cnodejs.org/topic/5231a630101e574521e45ef8" target="_blank" rel="external">exports 和 module.exports 的区别</a></li>
</ul>
<p><code>RequireJS</code>是基于<code>AMD</code>规范实现的，那么这个问题变成了：<code>AMD</code>，<code>CommonJS</code>和<code>ES6</code>内置模块各自的区别。<br>在回答问题之前，还是先回顾一下这三种方式引入和导出模块的使用方法吧。</p>
<h2 id="AMD"><a href="#AMD" class="headerlink" title="AMD"></a>AMD</h2><p>在<code>RequireJS</code>中</p>
<ul>
<li>使用<code>define()</code>导出模块</li>
<li>使用<code>require()</code>引入模块</li>
</ul>
<h3 id="使用方法"><a href="#使用方法" class="headerlink" title="使用方法"></a>使用方法</h3><p><strong>导出模块</strong><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// lib1.js</span></div><div class="line">define([], <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="keyword">return</span> &#123;</div><div class="line">        test: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">            <span class="built_in">console</span>.log(<span class="string">"this is test in lib1.js"</span>);</div><div class="line">        &#125;,</div><div class="line">        test2: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">          	<span class="built_in">console</span>.log(<span class="string">"this is test 2 in lib1.js"</span>);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<p><strong>引入模块</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">// index.js</div><div class="line">require([&quot;lib1&quot;], function (lib1) &#123;</div><div class="line">    lib1.test();</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<p>可以看见，<code>lib1</code>模块的全部方法都会被<code>require</code>引入并作为模块的方法进行调用。</p>
<h3 id="路径解析"><a href="#路径解析" class="headerlink" title="路径解析"></a>路径解析</h3><p>之前写过<a href="#/title/RequireJS%E4%BD%BF%E7%94%A8%E5%BF%83%E5%BE%97">RequireJS使用心得</a>，这里简单回顾一下，关于具体的使用方式就不展开了。</p>
<ul>
<li>基础路径<code>baseUrl</code><ul>
<li>相对路径<ul>
<li>没有配置<code>data-main</code>，则<code>baseurl</code>为引入<code>require.js</code>的html文档所在路径</li>
<li>已配置<code>data-main</code>，则<code>baseurl</code>为<code>data-main</code>指向模块所处的路径</li>
<li>显示调用<code>require.config()</code>进行配置</li>
</ul>
</li>
<li>绝对路径</li>
</ul>
</li>
<li>模块路径<code>paths</code><ul>
<li>具体文件名</li>
<li>文件夹 </li>
</ul>
</li>
<li>模块ID<code>module ID</code><ul>
<li>常规，不带<code>.js</code> </li>
</ul>
</li>
</ul>
<h3 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h3><p>由于浏览器在解析文档时，遇见脚本会加载解析和执行，为了提高页面性能，一般的处理办法是异步延迟加载，这正是<code>AMD</code>全称中<code>Asynchronous</code>的含义。<br>异步带来的问题是：在浏览器中，必须等待依赖的模块加载成功，对应的声明模块才能够执行。换句话说，<code>AMD</code>中的模块是<strong>依赖前置</strong>的。</p>
<h2 id="CommonJS"><a href="#CommonJS" class="headerlink" title="CommonJS"></a>CommonJS</h2><p>在<code>NodeJS</code>中</p>
<ul>
<li>使用<code>module.exports</code>导出模块</li>
<li>使用<code>require</code>引入模块</li>
</ul>
<h3 id="使用方法-1"><a href="#使用方法-1" class="headerlink" title="使用方法"></a>使用方法</h3><p>定义模块<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params">...args</span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> sum = <span class="number">0</span>;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> v <span class="keyword">of</span> args)&#123;</div><div class="line">        sum += v;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="built_in">console</span>.log(sum);</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">// 导出方式1</span></div><div class="line"><span class="built_in">module</span>.exports = &#123;</div><div class="line">    add</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="comment">// 导出方式2</span></div><div class="line">exports.add = add;</div></pre></td></tr></table></figure></p>
<p>引入模块<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> math = <span class="built_in">require</span>(<span class="string">"./module1"</span>);</div><div class="line">math.add(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>);</div></pre></td></tr></table></figure></p>
<p>需要注意的是<code>CommonJS</code>是同步加载的，也就是说加载模块时会阻塞后续代码的执行，这对于服务器端来讲问题不大，但是对于浏览器而言网络传输的效率是不容忽视的，所以才有了<code>AMD</code>规范。</p>
<h3 id="module-exports和exports"><a href="#module-exports和exports" class="headerlink" title="module.exports和exports"></a>module.exports和exports</h3><p>初始使用<code>NodeJS</code>中的模块时，难免对于<code>module.exports</code>和<code>exports</code>的用法产生疑惑。实际上社区的很详细的讲解了这个问题，总结一下；</p>
<ul>
<li>整个文件导出的模块（也就是<code>require()</code> 的返回）是 <code>module.exports</code></li>
<li><code>module.exports</code>和<code>exports</code>在初始时指向同一个对象，因此可以使用<code>exports</code>向模块对象上增加属性和方法</li>
<li><code>module.exports</code>如果指向了另外一个对象，则<code>exports</code>的修改全部无效了（因为最后导出的是<code>module.exports</code>）</li>
</ul>
<p>可以理解为<code>exports</code>是<code>module.exports</code>的一个快捷方式，无论是修改了<code>module.exports</code>还是<code>exports</code>的指向，都会修改模块的导出。</p>
<p>如果还有疑问，可以移步：</p>
<ul>
<li><a href="https://www.ycjcl.cc/2017/02/10/module-exportshe-exportsde-qu-bie/" target="_blank" rel="external">Module.exports和exports的区别</a></li>
<li><a href="http://cnodejs.org/topic/5231a630101e574521e45ef8" target="_blank" rel="external">NodeJS社区</a></li>
</ul>
<h3 id="模块加载顺序"><a href="#模块加载顺序" class="headerlink" title="模块加载顺序"></a>模块加载顺序</h3><p>在<code>NodeJS</code>中，我们使用<code>npm</code>来安装和管理第三方工具包，然后可以使用<code>require</code>很方便的引入插件。那么，<code>NodeJS</code>中的<code>require</code>到底是怎么样的加载顺序呢？参考阮老师的<a href="http://www.ruanyifeng.com/blog/2015/05/require.html" target="_blank" rel="external">require()源码解读</a>，一个<code>require(X)</code>表达式，可能存在下面几种情况：</p>
<ul>
<li>如果X是内置模块（比如<code>require(&quot;http&quot;)</code>）<ul>
<li>返回该模块</li>
<li>不再继续执行</li>
</ul>
</li>
<li>如果 X 以<code>./</code> 或者 <code>/</code> 或者 <code>../</code> 开头<ul>
<li>根据 X 所在的父模块，确定 X 的绝对路径。 </li>
<li>将 X 当成文件，依次查找<code>X</code>,<code>X.js</code>,<code>X.json</code>,<code>X.node</code>，只要其中有一个存在，就返回该文件，不再继续执行。</li>
</ul>
</li>
<li>将 X 当成目录，依次查找<code>X/package.json</code>,<code>X/index.js</code>,<code>X/index.json</code>,<code>X/index.node</code>，只要其中有一个存在，就返回该文件，不再继续执行 </li>
<li>如果 X 不带路径（加载第三方模块比如<code>require(&quot;gulp&quot;)</code>）<ul>
<li>根据 X 所在的父模块，确定 X 可能的安装目录</li>
<li>依次在每个目录中，将 X 当成文件名或目录名加载</li>
</ul>
</li>
<li>抛出 <code>not found</code> </li>
</ul>
<p>可以看见，规则还是比较复杂的，<code>require</code>会尝试尽可能去成功加载对应的文件，在内部源码中是<code>Module</code>类实现的，这里暂时就没有深入了解了。</p>
<h2 id="ES6中的模块"><a href="#ES6中的模块" class="headerlink" title="ES6中的模块"></a>ES6中的模块</h2><p>在<code>ES6</code>中，采用了跟<code>python</code>类似的模块语法</p>
<ul>
<li>使用<code>exports</code>导出模块，<a href="">文档传送门</a></li>
<li>使用<code>import</code>引入模块，<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/import" target="_blank" rel="external">文档传送门</a></li>
</ul>
<p>由于还存在很多兼容的问题，因此这里直接把文档拿过来了，主要只是在<code>Vue-cli</code>中使用到。</p>
<h3 id="导出模块"><a href="#导出模块" class="headerlink" title="导出模块"></a>导出模块</h3><p>导出方式分为两种：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 命名导出（每个模块可以多次使用）</span></div><div class="line"><span class="keyword">export</span> &#123; myFunction &#125;;</div><div class="line"><span class="keyword">export</span> <span class="keyword">const</span> foo = <span class="built_in">Math</span>.sqrt(<span class="number">2</span>);</div><div class="line"></div><div class="line"><span class="comment">// 默认导出（每个脚本只能有一个默认导出）</span></div><div class="line"><span class="keyword">export</span> <span class="keyword">default</span> myFunctionOrClass</div></pre></td></tr></table></figure></p>
<h3 id="引入模块"><a href="#引入模块" class="headerlink" title="引入模块"></a>引入模块</h3><p>ES6与<code>CommonJS</code>和<code>AMD</code>最大的区别在于引入模块的方式，既可以引入整个模块，也可以引入某块的某一部分！<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 导入整个模块的内容</span></div><div class="line"><span class="keyword">import</span>  * <span class="keyword">as</span> myModule <span class="keyword">from</span> <span class="string">"my-module"</span>;</div><div class="line"></div><div class="line"><span class="comment">// 导入模块的单个成员</span></div><div class="line"><span class="keyword">import</span> &#123;myMember&#125; <span class="keyword">from</span> <span class="string">"my-module</span></div><div class="line"><span class="string"></span></div><div class="line"><span class="string">// 导入模块的多个成员</span></div><div class="line"><span class="string">import &#123;foo, bar&#125; from "</span>my-<span class="built_in">module</span></div></pre></td></tr></table></figure></p>
<h2 id="简易的模块系统"><a href="#简易的模块系统" class="headerlink" title="简易的模块系统"></a>简易的模块系统</h2><p>这里我们实现一个极其简易的模块系统（代码参考《你不知道的JavaScript上卷》）。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="comment">// 定义一个保存模块的闭包变量</span></div><div class="line">    <span class="keyword">var</span> modules = &#123;&#125;;</div><div class="line"></div><div class="line">    <span class="comment">// define和require接口用于修改和使用modules变量</span></div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">define</span>(<span class="params">name, deps, fn</span>) </span>&#123;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; deps.length; i++) &#123;</div><div class="line">            deps[i] = modules[deps[i]];</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        modules[name] = fn.apply(fn, deps);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">require</span>(<span class="params">name</span>) </span>&#123;</div><div class="line">        <span class="keyword">return</span> modules[name];</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="built_in">window</span>.require = <span class="built_in">require</span>;</div><div class="line">    <span class="built_in">window</span>.define = define;</div><div class="line">&#125;)();</div></pre></td></tr></table></figure></p>
<p>上面这段代码声明了一个局部变量<code>modules</code>用于保存模块，向外提供了<code>require</code>和<code>define</code>两个接口加载和声明模块。当然，这段代码并不能用在实际生产中，因为还缺少很多东西（比如<code>AMD</code>最重要的异步加载）。<br>不过，这里还是能大概了解模块的含义，我对于模块的理解就是：按功能将独立的逻辑，封装成可重用的代码块，然后对外提供模块的调用接口。归根结底，都是为了更加规范更加方便的写代码和维护代码嘛~</p>

    </div>
    <footer class="article_ft">
        
        <a href="/tags/工程化" class="article_tag">#工程化</a>
        
    </footer>

    <div class="article_nav"><a href="/article/mockjs使用心得" class="hover-highlight article_prev">mockjs使用心得</a><a
                href="/article/博客SSR实践总结" class="hover-highlight article_next">博客SSR实践总结</a></div>
</article>
        </div>
    </main>

    <aside>
    <div class="page_sd hide-md">
        <div class="tab">
            <!---->
            
            <ul class="tab_nav">
                <li class="tab_item active" data-target="#J_toc">
                    文章目录
                </li>
                <li class="tab_item" data-target="#J_profile">
                    站点资料
                </li>
            </ul>
            <div class="tab_panel active" id="J_toc">
                <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#AMD"><span class="toc-number">1.</span> <span class="toc-text">AMD</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#使用方法"><span class="toc-number">1.1.</span> <span class="toc-text">使用方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#路径解析"><span class="toc-number">1.2.</span> <span class="toc-text">路径解析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#小结"><span class="toc-number">1.3.</span> <span class="toc-text">小结</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CommonJS"><span class="toc-number">2.</span> <span class="toc-text">CommonJS</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#使用方法-1"><span class="toc-number">2.1.</span> <span class="toc-text">使用方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#module-exports和exports"><span class="toc-number">2.2.</span> <span class="toc-text">module.exports和exports</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#模块加载顺序"><span class="toc-number">2.3.</span> <span class="toc-text">模块加载顺序</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ES6中的模块"><span class="toc-number">3.</span> <span class="toc-text">ES6中的模块</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#导出模块"><span class="toc-number">3.1.</span> <span class="toc-text">导出模块</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#引入模块"><span class="toc-number">3.2.</span> <span class="toc-text">引入模块</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#简易的模块系统"><span class="toc-number">4.</span> <span class="toc-text">简易的模块系统</span></a></li></ol>
            </div>
            
            <div class="tab_panel " id="J_profile">
                <div>
                    <div class="me">
                        <img src="http://shymean.com/_nuxt/img/head.dd612ee.jpg" alt="shymean" width="100" height="100">
                        <h3>shymean</h3>
                        <p>一个不学无术且无趣的人。</p>
                    </div>
                    <div class="nav-border">
                        <a href="/book" class="nav_item">
                            <i class="iconfont icon-bookshelf"></i>
                            <br>书架
                        </a>
                        <a href="/message" class="nav_item">
                            <i class="iconfont icon-comment"></i>
                            <br>留言
                        </a>
                        <a href="/about" class="nav_item">
                            <i class="iconfont icon-info"></i>
                            <br>关于
                        </a>
                    </div>
                    <div class="contact">
                        <a href="https://github.com/tangxiangmin" target="_blank" class="contact_link">
                            <i class="iconfont icon-github"></i> GitHub</a>
                        <a href="http://wpa.qq.com/msgrd?v=3&amp;uin=645234650&amp;site=qq&amp;menu=yes"
                            target="_blank" class="contact_link">
                            <i class="iconfont icon-qq"></i> QQ</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="tool">
        <div class="btn-list hide-md" id="J_toggleSide">
            <div class="btn-icon">
                <span class="btn-line"></span>
                <span class="btn-line"></span>
                <span class="btn-line"></span>
            </div>
        </div>
        <div class="btn-top">
            <i class="iconfont icon-top"></i>
        </div>
    </div>
</aside>
    <footer class="page_ft">
    <div class="container footer">
        <p>世人的悲欢并不相通，我只是觉得他们吵闹。</p>
        <p>
            Copyright © Shymean 2016 - 2017
            <a href="http://www.miitbeian.gov.cn" rel="nofollow" target="_blank" style="display:inline-block;">粤ICP备17060238号-1</a>
        </p>
    </div>
    <div class="hide-xs">
        <script src="https://s19.cnzz.com/z_stat.php?id=1264491168&amp;web_id=1264491168" language="JavaScript"></script>
    </div>
</footer>

</div>

</body>
</html>