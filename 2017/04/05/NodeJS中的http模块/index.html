<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <link rel="stylesheet" href="/css/blog.css">
    <link rel="stylesheet" href="/css/fonts/iconfont.css">
    <!--<link rel="stylesheet" href="//cdn.bootcss.com/highlight.js/9.2.0/styles/github.min.css">-->
    <link rel="stylesheet" href="//cdn.bootcss.com/fancybox/3.1.25/jquery.fancybox.min.css">
    <script src="/js/require.js" data-main="/js/main"></script>
</head>
<body>
<div id="blog" class="page page-theme-base" v-cloak>
    <blog-header></blog-header>
    <header class="page_hd" data-v-04342fbc="">
    <div class="container header" data-v-04342fbc="">
        <h1 class="logo" data-v-04342fbc="">
            <a href="/" class="nuxt-link-exact-active nuxt-link-active" data-v-04342fbc="">橙红年代</a>
        </h1>
        <div class="show-md" data-v-04342fbc="">
            <div class="btn-list" data-v-04342fbc="">
                <div class="btn-icon" data-v-04342fbc="">
                    <span class="btn-line" data-v-04342fbc=""></span>
                    <span class="btn-line" data-v-04342fbc=""></span>
                    <span class="btn-line" data-v-04342fbc=""></span>
                </div>
            </div>
        </div>
        <nav class="nav-responsive" data-v-04342fbc="">
            
            <a class="nav_item" href="/">首页</a>
            
            <a class="nav_item" href="/archives">归档</a>
            
            <a class="nav_item" href="/tags">标签</a>
            
            <a class="nav_item" href="/test">Test</a>
            
        </nav>
    </div>
</header>
    <main class="page_mn" >
        <div class="container">
            <article class="article article-detail">
    <header class="text-center">
        <h2 class="article_hd">NodeJS中的http模块</h2>
        <div class="article_info">
            <span class="hide-sm">发表于</span>
            <span class="show-sm">
                <i class="iconfont icon-archives"></i>
            </span>
            <time>2017/4/5 21:41:31</time>
            |
            <span class="hide-sm">分类于</span>
            <span class="show-sm"><i class="iconfont icon-tag"></i></span>
            
                <a href="/categories/JavaScript" class="hover-highlight">JavaScript</a>
            

        </div>
    </header>
    <div class="article_ct">
        <p>尽管<code>express</code>和<code>koa</code>等优秀的库已经对<code>http</code>模块进行了封装，但是针对NodeJS的Web开发，还是很有必须了解一下<code>http</code>模块。</p>
<a id="more"></a>
<p>参考:</p>
<ul>
<li><a href="http://www.cnblogs.com/bigbearbb/p/4213524.html" target="_blank" rel="external">大熊君大话NodeJS之——Http模块</a></li>
<li><a href="http://blog.csdn.net/woshinannan741/article/details/51357464" target="_blank" rel="external">Node中的Http</a></li>
</ul>
<p>http模块的属性和方法可以分成客户端和服务端两部分，另外还有一个常量属性<code>STATUS_CODES</code>保存了http响应报文起始行的状态码和相关描述。</p>
<h2 id="客户端"><a href="#客户端" class="headerlink" title="客户端"></a>客户端</h2><p><strong>http.ClientRequest</strong><br>抽象为一个客户端请求对象，常用的有<code>write</code>等方法，也有<code>data</code>,<code>end</code>等事件。<br>此外可以把客户端请求对象当作一个只读数据流来访问请求体数据。</p>
<p><strong>http.request</strong><br>用于客户端发出请求，返回的是一个<code>http.ClientRequest</code>的实例<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> contents = <span class="string">"Hello World"</span>;</div><div class="line"></div><div class="line"><span class="comment">// 配置参数</span></div><div class="line"><span class="keyword">let</span> opt = &#123;</div><div class="line">    host: <span class="string">"localhost"</span>,</div><div class="line">    path:<span class="string">'/'</span>,</div><div class="line">    port:<span class="number">3000</span>,</div><div class="line">    method:<span class="string">'POST'</span>,</div><div class="line">    headers:&#123;</div><div class="line">        <span class="string">'Content-Type'</span>:<span class="string">'application/x-www-form-urlencoded'</span>,</div><div class="line">        <span class="string">'Content-Length'</span>:contents.length</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">let</span> req = http.request(opt,(res)=&gt;&#123;</div><div class="line">    <span class="comment">// res是请求返回结果</span></div><div class="line">&#125;)</div><div class="line"></div><div class="line">req.write(contents);</div><div class="line">req.end();</div></pre></td></tr></table></figure></p>
<p><strong>http.get</strong><br><code>http.request</code>的<code>method:&quot;GET</code>的快捷方式，且不需要显示调用<code>req.end()</code>方法。之前的静态爬虫就是使用get来实现的。</p>
<p>注意，由于需要调用<code>write</code>向服务器发送数据，貌似并没有<code>http.post</code>的快捷方式哦</p>
<h2 id="服务端"><a href="#服务端" class="headerlink" title="服务端"></a>服务端</h2><h3 id="http-Server"><a href="#http-Server" class="headerlink" title="http.Server"></a>http.Server</h3><p>抽象为一个服务器对象，<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> server = <span class="keyword">new</span> http.Server();</div><div class="line"></div><div class="line"><span class="comment">/* 事件 */</span></div><div class="line">server.on(<span class="string">"request"</span>, requestListener);</div><div class="line"></div><div class="line">server.on(<span class="string">"conection"</span>,()=&gt;&#123;&#125;);</div><div class="line"></div><div class="line">server.on(<span class="string">"close"</span>,()=&gt;&#123;&#125;)</div><div class="line"></div><div class="line"><span class="comment">/* 方法 */</span></div><div class="line">server.listen(<span class="number">888</span>);</div><div class="line"></div><div class="line">server.close();</div></pre></td></tr></table></figure></p>
<p>由于<code>request</code>事件使用的太频繁了，http模块上直接注册了一个<code>createServer</code>方法作为该事件的快捷方式。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">http.createServer(requestListener)</div></pre></td></tr></table></figure></p>
<h3 id="requestListener"><a href="#requestListener" class="headerlink" title="requestListener"></a>requestListener</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">function requestListener(req,res)&#123;</div><div class="line">    // req是http.IncomingMessage的一个实例 </div><div class="line">    // res是http.ServerResponse的一个实例</div><div class="line">    // todo</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><code>requestListener</code>是一个回调函数，它将会自动加入到<code>request</code> 事件的监听队列。当<code>request</code>事件触发时，<code>Event-Loop</code>会将该事件处理函数放入执行队列,当前面的队列函数执行完毕之后，就会执行该事件处理函数。</p>
<p>这里需要明白的是：Node中所有的代码都是一个一个从执行队列中拿出来执行的。这些执行都是在工作线程上(Event Loop本身可以认为在一个独立的线程中，我们一般不提这个线程，而将node称呼为一个单线程的执行环境)，所有的回调都是在一个工作线程上运行。</p>
<h3 id="http-IncomingMessage"><a href="#http-IncomingMessage" class="headerlink" title="http.IncomingMessage"></a>http.IncomingMessage</h3><p>抽象为服务器接受到的请求对象（假装是http.ServerRequest这样命名的东西），主要定义了<code>data</code>,<code>end</code>,<code>close</code>这几个事件，常用的属性有<code>header</code>,<code>url</code>,<code>httpVersion</code>,<code>statusCode</code>等<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">function requestListener(req,res)&#123;</div><div class="line">    let msg = &quot;&quot;;</div><div class="line">	req.on(&quot;data&quot;,(chunk)=&gt;&#123;</div><div class="line">		msg += chunk;</div><div class="line">	&#125;)</div><div class="line">	req.on(&quot;error&quot;,(err)=&gt;&#123;</div><div class="line">		console.log(&apos;something wrong&apos;);</div><div class="line">	&#125;)</div><div class="line"></div><div class="line">	req.on(&quot;end&quot;,()=&gt;&#123;</div><div class="line">		// todo</div><div class="line">	&#125;)</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>IncomingMessage对象可以由<code>http.Server</code>或<code>http.ClientRequest</code>创建。</p>
<h3 id="http-ServerResponse"><a href="#http-ServerResponse" class="headerlink" title="http.ServerResponse"></a>http.ServerResponse</h3><p>抽象为一个服务器响应对象，常用的方法有<code>writeHead</code>,<code>write</code>,<code>end</code>等，事件貌似只有<code>close</code>。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">req.on(&quot;end&quot;,()=&gt;&#123;</div><div class="line">	res.writeHead(200, &#123;&quot;Content-type&quot;:&quot;text/plain&quot;&#125;);</div><div class="line">	res.write(&quot;hello, I have recive:&quot; + msg);</div><div class="line">	res.end();</div><div class="line">&#125;)</div></pre></td></tr></table></figure></p>
<h2 id="Express中的封装"><a href="#Express中的封装" class="headerlink" title="Express中的封装"></a>Express中的封装</h2><h3 id="基础"><a href="#基础" class="headerlink" title="基础"></a>基础</h3><p><code>epxress</code>在http模块的基础上进行了封装<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">let express = require(&apos;express&apos;);</div><div class="line">let app = express();</div><div class="line"></div><div class="line">// 启动服务器</div><div class="line">let server = app.listen(3000, function () &#123;</div><div class="line">    console.log(&quot;server is running~&quot;);</div><div class="line">&#125;);</div><div class="line"></div><div class="line">// 监听路由</div><div class="line">app.get(&apos;/&apos;, function (req, res) &#123;</div><div class="line">    res.send(&quot;hello&quot;);</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<h3 id="路由"><a href="#路由" class="headerlink" title="路由"></a>路由</h3><p>路由可以看作是HTTP请求的CGI，由后台定义路由的处理逻辑，当接收到相应请求后就将请求转移到对应的路由处理方法。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">app.post(&apos;/posttest&apos;, function (req, res) &#123;</div><div class="line">    res.send(&quot;post test&quot;);</div><div class="line">    // 根据请求数据做点事</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<p>常用的路由方法有<code>get</code>,<code>post</code>,<code>delete</code>等多种，其中，<code>all</code>是一种特殊的方法,它的作用是对于一个路径上的所有请求加载中间件。</p>
<h2 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h2><p>尽管一直想使用NodeJS进行web开发，却一直没有机会。这里整理了一点http模块的东西，接下来打算好好看一看<code>Express</code>，写个小项目练练手。</p>

    </div>
    <footer class="article_ft">
        
        <a href="/tags/NodeJS" class="article_tag">#NodeJS</a>
        
    </footer>

    <div class="article_nav"><a href="/article/mockjs使用心得" class="hover-highlight article_prev">mockjs使用心得</a><a
                href="/article/博客SSR实践总结" class="hover-highlight article_next">博客SSR实践总结</a></div>
</article>
        </div>
    </main>

    <aside>
    <div class="page_sd hide-md">
        <div class="tab">
            <!---->
            
            <ul class="tab_nav">
                <li class="tab_item active" data-target="#J_toc">
                    文章目录
                </li>
                <li class="tab_item" data-target="#J_profile">
                    站点资料
                </li>
            </ul>
            <div class="tab_panel active" id="J_toc">
                <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#客户端"><span class="toc-number">1.</span> <span class="toc-text">客户端</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#服务端"><span class="toc-number">2.</span> <span class="toc-text">服务端</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#http-Server"><span class="toc-number">2.1.</span> <span class="toc-text">http.Server</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#requestListener"><span class="toc-number">2.2.</span> <span class="toc-text">requestListener</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#http-IncomingMessage"><span class="toc-number">2.3.</span> <span class="toc-text">http.IncomingMessage</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#http-ServerResponse"><span class="toc-number">2.4.</span> <span class="toc-text">http.ServerResponse</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Express中的封装"><span class="toc-number">3.</span> <span class="toc-text">Express中的封装</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#基础"><span class="toc-number">3.1.</span> <span class="toc-text">基础</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#路由"><span class="toc-number">3.2.</span> <span class="toc-text">路由</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#小结"><span class="toc-number">4.</span> <span class="toc-text">小结</span></a></li></ol>
            </div>
            
            <div class="tab_panel " id="J_profile">
                <div>
                    <div class="me">
                        <img src="http://shymean.com/_nuxt/img/head.dd612ee.jpg" alt="shymean" width="100" height="100">
                        <h3>shymean</h3>
                        <p>一个不学无术且无趣的人。</p>
                    </div>
                    <div class="nav-border">
                        <a href="/book" class="nav_item">
                            <i class="iconfont icon-bookshelf"></i>
                            <br>书架
                        </a>
                        <a href="/message" class="nav_item">
                            <i class="iconfont icon-comment"></i>
                            <br>留言
                        </a>
                        <a href="/about" class="nav_item">
                            <i class="iconfont icon-info"></i>
                            <br>关于
                        </a>
                    </div>
                    <div class="contact">
                        <a href="https://github.com/tangxiangmin" target="_blank" class="contact_link">
                            <i class="iconfont icon-github"></i> GitHub</a>
                        <a href="http://wpa.qq.com/msgrd?v=3&amp;uin=645234650&amp;site=qq&amp;menu=yes"
                            target="_blank" class="contact_link">
                            <i class="iconfont icon-qq"></i> QQ</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="tool">
        <div class="btn-list hide-md" id="J_toggleSide">
            <div class="btn-icon">
                <span class="btn-line"></span>
                <span class="btn-line"></span>
                <span class="btn-line"></span>
            </div>
        </div>
        <div class="btn-top">
            <i class="iconfont icon-top"></i>
        </div>
    </div>
</aside>
    <footer class="page_ft">
    <div class="container footer">
        <p>世人的悲欢并不相通，我只是觉得他们吵闹。</p>
        <p>
            Copyright © Shymean 2016 - 2017
            <a href="http://www.miitbeian.gov.cn" rel="nofollow" target="_blank" style="display:inline-block;">粤ICP备17060238号-1</a>
        </p>
    </div>
    <div class="hide-xs">
        <script src="https://s19.cnzz.com/z_stat.php?id=1264491168&amp;web_id=1264491168" language="JavaScript"></script>
    </div>
</footer>

</div>

</body>
</html>