<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <link rel="stylesheet" href="/css/blog.css">
    <link rel="stylesheet" href="/css/fonts/iconfont.css">
    <!--<link rel="stylesheet" href="//cdn.bootcss.com/highlight.js/9.2.0/styles/github.min.css">-->
    <link rel="stylesheet" href="//cdn.bootcss.com/fancybox/3.1.25/jquery.fancybox.min.css">
    <script src="/js/require.js" data-main="/js/main"></script>
</head>
<body>
<div id="blog" class="page page-theme-base" v-cloak>
    <blog-header></blog-header>
    <header class="page_hd" data-v-04342fbc="">
    <div class="container header" data-v-04342fbc="">
        <h1 class="logo" data-v-04342fbc="">
            <a href="/" class="nuxt-link-exact-active nuxt-link-active" data-v-04342fbc="">橙红年代</a>
        </h1>
        <div class="show-md" data-v-04342fbc="">
            <div class="btn-list" data-v-04342fbc="">
                <div class="btn-icon" data-v-04342fbc="">
                    <span class="btn-line" data-v-04342fbc=""></span>
                    <span class="btn-line" data-v-04342fbc=""></span>
                    <span class="btn-line" data-v-04342fbc=""></span>
                </div>
            </div>
        </div>
        <nav class="nav-responsive" data-v-04342fbc="">
            
            <a class="nav_item" href="/">首页</a>
            
            <a class="nav_item" href="/archives">归档</a>
            
            <a class="nav_item" href="/tags">标签</a>
            
        </nav>
    </div>
</header>
    <main class="page_mn" >
        <div class="container">
            <article class="article article-detail">
    <header class="text-center">
        <h2 class="article_hd">换一种rem方式进行移动端布局</h2>
        <div class="article_info">
            <span class="hide-sm">发表于</span>
            <span class="show-sm">
                <i class="iconfont icon-archives"></i>
            </span>
            <time>2018/4/15 21:37:51</time>
            |
            <span class="hide-sm">分类于</span>
            <span class="show-sm"><i class="iconfont icon-tag"></i></span>
            
                <a href="/categories/CSS" class="hover-highlight">CSS</a>
            

        </div>
    </header>
    <div class="article_ct">
        <p>公司的移动端项目，包括app内的webview页面和Wap端网站，均采用rem进行布局，不过并不是基于<a href="https://github.com/amfe/lib-flexible" target="_blank" rel="external">flexible.js</a>通过js去设置根字体大小，而是采用纯CSS实现的rem布局，在项目中的效果还不错，下面简单整理一下。</p>
<a id="more"></a>
<p>其实早前已经在<a href="https://github.com/tangxiangmin/rem" target="_blank" rel="external">github</a>开了一个项目，这里只是把相关内容补充一下。</p>
<p>参考：</p>
<ul>
<li><a href="http://www.zhangxinxu.com/wordpress/2016/08/vw-viewport-responsive-layout-typography/" target="_blank" rel="external">基于vw等viewport视区单位配合rem响应式排版和布局</a>，整个实现的核心思想就是参考了张鑫旭大神的这篇博客</li>
<li><a href="http://yanhaijing.com/css/2017/09/29/principle-of-rem-layout/" target="_blank" rel="external">Rem布局的原理解析</a></li>
</ul>
<h2 id="实现原理"><a href="#实现原理" class="headerlink" title="实现原理"></a>实现原理</h2><p>rem布局的本质是等比缩放，其基本原理就是通过html根字体大小去设置布局尺寸的大小，不同的分辨率对应不同的根字体，这样就可以按比例还原设计图了。</p>
<p>当然这里我们讨论的不是rem布局的原理，而是如何基于CSS去实现rem布局，其实现十分简单。<br><figure class="highlight scss"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="variable">$design-width</span>: <span class="number">750</span>;</div><div class="line"><span class="selector-tag">html</span> &#123;</div><div class="line">    <span class="attribute">font-size</span>: calc((<span class="number">100vw</span> / <span class="variable">$design-width</span>) * <span class="number">100</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>分别解释一下：</p>
<ul>
<li><code>100vw</code>表示屏幕的宽度</li>
<li><code>$design-width</code>表示设计图尺寸，项目中一般为750px</li>
<li><code>calc</code>，CSS3新增的属性，通过计算来决定一个CSS属性值，参考<a href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/calc" target="_blank" rel="external">MDN文档</a></li>
</ul>
<p>上面的样式声明了html的字体大小（即rem值），其值为窗口大小 / 设计图尺寸 的100倍，之所以设置为100倍，是为了防止浏览器的最小字体限制导致的渲染错误。<br>仅仅通过上面这一段代码，就可以根据屏幕分辨率，自动计算rem大小，然后只需要在布局中采用rem作为尺寸单位，即可实现rem布局，是不是很神奇！</p>
<h2 id="设计图尺寸"><a href="#设计图尺寸" class="headerlink" title="设计图尺寸"></a>设计图尺寸</h2><p>为什么要将rem大小与设计图尺寸相关联呢？这样处理的话，我们可以直接将设计图标注的尺寸编写到样式表中，而无需再次计算对应的换算关系。</p>
<p>可以通过下面这个scss函数将设计图尺寸转换为rem<br><figure class="highlight scss"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">@function rem(<span class="variable">$px</span>) &#123;</div><div class="line">    @<span class="keyword">if</span> (unitless(<span class="variable">$px</span>)) &#123;</div><div class="line">        @return 1rem * (<span class="variable">$px</span>/<span class="number">100</span>);</div><div class="line">    &#125; @<span class="keyword">else</span> &#123;</div><div class="line">        @return 1rem * (<span class="variable">$px</span>/<span class="number">100px</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>其中<code>$px</code>参数即为设计图标注的尺寸，样式表中只需要编写如下代码即可<br><figure class="highlight scss"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="selector-class">.box</span> &#123;</div><div class="line">    <span class="attribute">width</span>:rem(<span class="number">200</span>)</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>其中，200为750标准设计图的标注尺寸。这样基本可以完美还原设计图。甚至在微信小程序中的开发中，可以通过将rem单位修改为rpx（这个是小程序本身的rem实现单位），实现样式表的无缝迁移~</p>
<p>其实现在有相关的postCSS插件可以实现自动将px转换为rem单位，比如<a href="https://github.com/cuth/postcss-pxtorem" target="_blank" rel="external">pxtorem</a>。</p>
<p>但是在由于公司项目的特殊性（文字阅读），某些地方还是依赖于px进行单位设置，因此我更倾向于通过这个<code>rem</code>函数来进行手动控制样式表。根据过去的项目经验，敲一个<code>rem(200)</code>和<code>200px</code>然后进行pxtorem的转换，工作成本其实是差不多的。</p>
<h2 id="最大尺寸"><a href="#最大尺寸" class="headerlink" title="最大尺寸"></a>最大尺寸</h2><p>使用rem布局的一个问题是在PC端打开的移动端页面有些奇怪，。因为PC的宽度比较大，因此计算得到的rem也会比较大，导致设计图放大到了一个不太合理的比例。</p>
<p>我的解决办法是给定一个页面宽度的最大值<br><figure class="highlight scss"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">@<span class="keyword">media</span> screen and (min-width:<span class="number">800px</span>) &#123;</div><div class="line">    <span class="selector-tag">html</span> &#123;</div><div class="line">        <span class="attribute">font-size</span>: <span class="number">100px</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="selector-tag">body</span> &#123;</div><div class="line">        <span class="attribute">width</span>: <span class="number">800px</span>;</div><div class="line">        <span class="attribute">margin</span>: <span class="number">0</span> auto;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>这样的话即使在很大的屏幕上，整个页面也能比较合理的展示。</p>
<p>但是会引入另外一个问题，即fixed的元素可能会溢出容器，在某些<code>fixed</code>定位、宽度为<code>100%</code>的DOM上，表现的就比较奇怪了，因为他们的包含块是窗口本身，处理方式是定义一个<code>rem-fixed</code>的颗粒类<br><figure class="highlight scss"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">@<span class="keyword">media</span> screen and (min-width:<span class="number">800px</span>) &#123;</div><div class="line">   <span class="selector-class">.rem-fixed</span> &#123;</div><div class="line">       <span class="attribute">width</span>: <span class="number">800px</span>;</div><div class="line">       <span class="attribute">left</span>: <span class="number">0</span>;</div><div class="line">       <span class="attribute">right</span>: <span class="number">0</span>;</div><div class="line">       <span class="attribute">margin-left</span>: auto;</div><div class="line">       <span class="attribute">margin</span>-rigth: auto;</div><div class="line">   &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>在某些特定的布局上可能会有些问题，按需处理即可。之前张鑫旭大神在博客中提出了一个更合理的实践方案<br><figure class="highlight scss"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line"><span class="selector-tag">html</span> &#123;</div><div class="line">    <span class="attribute">font-size</span>: <span class="number">16px</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line">@<span class="keyword">media</span> screen and (min-width: 375px) &#123;</div><div class="line">    <span class="selector-tag">html</span> &#123;</div><div class="line">        <span class="comment">/* iPhone6的375px尺寸作为16px基准，414px正好18px大小, 600 20px */</span></div><div class="line">        <span class="attribute">font-size</span>: calc(<span class="number">100%</span> + <span class="number">2</span> * (<span class="number">100vw</span> - <span class="number">375px</span>) / <span class="number">39</span>);</div><div class="line">        <span class="attribute">font-size</span>: calc(<span class="number">16px</span> + <span class="number">2</span> * (<span class="number">100vw</span> - <span class="number">375px</span>) / <span class="number">39</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line">@<span class="keyword">media</span> screen and (min-width: 414px) &#123;</div><div class="line">    <span class="selector-tag">html</span> &#123;</div><div class="line">        <span class="comment">/* 414px-1000px每100像素宽字体增加1px(18px-22px) */</span></div><div class="line">        <span class="attribute">font-size</span>: calc(<span class="number">112.5%</span> + <span class="number">4</span> * (<span class="number">100vw</span> - <span class="number">414px</span>) / <span class="number">586</span>);</div><div class="line">        <span class="attribute">font-size</span>: calc(<span class="number">18px</span> + <span class="number">4</span> * (<span class="number">100vw</span> - <span class="number">414px</span>) / <span class="number">586</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line">@<span class="keyword">media</span> screen and (min-width: 600px) &#123;</div><div class="line">    <span class="selector-tag">html</span> &#123;</div><div class="line">        <span class="comment">/* 600px-1000px每100像素宽字体增加1px(20px-24px) */</span></div><div class="line">        <span class="attribute">font-size</span>: calc(<span class="number">125%</span> + <span class="number">4</span> * (<span class="number">100vw</span> - <span class="number">600px</span>) / <span class="number">400</span>);</div><div class="line">        <span class="attribute">font-size</span>: calc(<span class="number">20px</span> + <span class="number">4</span> * (<span class="number">100vw</span> - <span class="number">600px</span>) / <span class="number">400</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line">@<span class="keyword">media</span> screen and (min-width: 1000px) &#123;</div><div class="line">    <span class="selector-tag">html</span> &#123;</div><div class="line">        <span class="comment">/* 1000px往后是每100像素0.5px增加 */</span></div><div class="line">        <span class="attribute">font-size</span>: calc(<span class="number">137.5%</span> + <span class="number">6</span> * (<span class="number">100vw</span> - <span class="number">1000px</span>) / <span class="number">1000</span>);</div><div class="line">        <span class="attribute">font-size</span>: calc(<span class="number">22px</span> + <span class="number">6</span> * (<span class="number">100vw</span> - <span class="number">1000px</span>) / <span class="number">1000</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>这里的缺点在于：尺寸并不是完全按照设计图的比例还原，如果设计师那边没问题，这种处理方式更优，因为页面能在PC上也能铺满整个屏幕。</p>
<h2 id="向后兼容"><a href="#向后兼容" class="headerlink" title="向后兼容"></a>向后兼容</h2><p>上面的实现完全由CSS控制，不需要根据JavaScript来动态计算根字体的大小。但是仍旧需要考虑calc兼容性的问题。这里是关于calc的<a href="https://caniuse.com/#search=calc" target="_blank" rel="external">兼容列表</a>，可以看见基本满足生产条件了。</p>
<p>在需要适配某些不支持calc特性的版本下（比如在Android V4.4.4以下版本不支持乘法和除法计算），可以使用JavaScript向下兼容（虽然很不情愿这么干~）</p>
<p>通过js计算rem大小比较容易<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> newRem = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> html = <span class="built_in">document</span>.documentElement</div><div class="line">    <span class="comment">// 设计图标准750px</span></div><div class="line">    <span class="keyword">var</span> baseWidth = <span class="number">750</span></div><div class="line">    <span class="comment">// 屏幕最大宽度800px</span></div><div class="line">    <span class="keyword">var</span> screenWidth = <span class="built_in">Math</span>.min(<span class="number">800</span>, html.getBoundingClientRect().width)</div><div class="line">    html.style.fontSize = screenWidth / <span class="number">750</span> * <span class="number">100</span> + <span class="string">'px'</span>;</div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<p>我们只需要在不支持calc特性的浏览器上调用<code>newRem</code>函数即可，下面是自己写的一个hack方法，暂时没找到更好的做法~<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 获取元素的计算样式</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">getStyle</span>(<span class="params">dom, key</span>)</span>&#123;</div><div class="line">    <span class="keyword">var</span> style</div><div class="line">    <span class="keyword">if</span> (<span class="built_in">window</span>.getComputedStyle) &#123;</div><div class="line">        style = <span class="built_in">window</span>.getComputedStyle(dom, <span class="literal">null</span>)</div><div class="line">    &#125; <span class="keyword">else</span> &#123; </div><div class="line">        style = dom.currentStyle  <span class="comment">// fuck IE</span></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">return</span> style[key]</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// 判断浏览器是否支持calc</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">isSupportCalc</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="keyword">var</span> oDiv = <span class="built_in">document</span>.createElement(<span class="string">"div"</span>);</div><div class="line">    oDiv.style.width = <span class="string">'calc((100vw / 750) * 100)'</span></div><div class="line">   </div><div class="line">    <span class="built_in">document</span>.body.appendChild(oDiv)</div><div class="line">    <span class="keyword">var</span> width = getStyle(oDiv, <span class="string">'width'</span>)</div><div class="line">    oDiv.remove()</div><div class="line"></div><div class="line">    <span class="keyword">var</span> diff = <span class="number">0.5</span></div><div class="line"></div><div class="line"> 	width = <span class="built_in">parseFloat</span>(width)</div><div class="line"> 	<span class="keyword">var</span> calcWidth = <span class="built_in">window</span>.screen.availWidth / <span class="number">750</span> * <span class="number">100</span></div><div class="line"></div><div class="line"> 	<span class="keyword">return</span> width &amp;&amp; <span class="built_in">Math</span>.abs(calcWidth - width) &lt; diff</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// 判断浏览器calc特性</span></div><div class="line"><span class="keyword">var</span> isSupport = isSupportCalc()</div><div class="line"><span class="keyword">if</span> (!isSupport)&#123;</div><div class="line">	<span class="built_in">window</span>.addEventListener(<span class="string">'resize'</span>, newRem, <span class="literal">false</span>);</div><div class="line">    newRem()</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>OK，这样就解决了calc不兼容或vw不兼容导致的页面排版异常的情形。</p>
<h2 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h2><p>之所以采用这种方式实现rem，最主要的原因是：<strong>非常酷</strong>。我一直坚信着能不用JS实现的CSS效果，就不用CSS实现。</p>
<p>毫无疑问，基于calc和vw实现的rem布局，刚好满足这个条件。因此我义无反顾地在项目中使用了这种形式，当然，为了向后兼容，还是需要引入相关的polyfill的，毕竟技术是为了业务服务的，我们还是需要对项目和用户负责的哈哈。</p>

    </div>
    <footer class="article_ft">
        
        <a href="/tags/布局" class="article_tag">#布局</a>
        
        <a href="/tags/rem" class="article_tag">#rem</a>
        
    </footer>

    <div class="article_nav"><a href="/article/mockjs使用心得" class="hover-highlight article_prev">mockjs使用心得</a><a
                href="/article/博客SSR实践总结" class="hover-highlight article_next">博客SSR实践总结</a></div>
</article>
        </div>
    </main>

    <aside>
    <div class="page_sd hide-md">
        <div class="tab">
            <!---->
            
            <ul class="tab_nav">
                <li class="tab_item active" data-target="#J_toc">
                    文章目录
                </li>
                <li class="tab_item" data-target="#J_profile">
                    站点资料
                </li>
            </ul>
            <div class="tab_panel active" id="J_toc">
                <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#实现原理"><span class="toc-number">1.</span> <span class="toc-text">实现原理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#设计图尺寸"><span class="toc-number">2.</span> <span class="toc-text">设计图尺寸</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#最大尺寸"><span class="toc-number">3.</span> <span class="toc-text">最大尺寸</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#向后兼容"><span class="toc-number">4.</span> <span class="toc-text">向后兼容</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#小结"><span class="toc-number">5.</span> <span class="toc-text">小结</span></a></li></ol>
            </div>
            
            <div class="tab_panel " id="J_profile">
                <div>
                    <div class="me">
                        <img src="http://shymean.com/_nuxt/img/head.dd612ee.jpg" alt="shymean" width="100" height="100">
                        <h3>shymean</h3>
                        <p>一个不学无术且无趣的人。</p>
                    </div>
                    <div class="nav-border">
                        <a href="/book" class="nav_item">
                            <i class="iconfont icon-bookshelf"></i>
                            <br>书架
                        </a>
                        <a href="/message" class="nav_item">
                            <i class="iconfont icon-comment"></i>
                            <br>留言
                        </a>
                        <a href="/about" class="nav_item">
                            <i class="iconfont icon-info"></i>
                            <br>关于
                        </a>
                    </div>
                    <div class="contact">
                        <a href="https://github.com/tangxiangmin" target="_blank" class="contact_link">
                            <i class="iconfont icon-github"></i> GitHub</a>
                        <a href="http://wpa.qq.com/msgrd?v=3&amp;uin=645234650&amp;site=qq&amp;menu=yes"
                            target="_blank" class="contact_link">
                            <i class="iconfont icon-qq"></i> QQ</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="tool">
        <div class="btn-list hide-md" id="J_toggleSide">
            <div class="btn-icon">
                <span class="btn-line"></span>
                <span class="btn-line"></span>
                <span class="btn-line"></span>
            </div>
        </div>
        <div class="btn-top">
            <i class="iconfont icon-top"></i>
        </div>
    </div>
</aside>
    <footer class="page_ft">
    <div class="container footer">
        <p>世人的悲欢并不相通，我只是觉得他们吵闹。</p>
        <p>
            Copyright © Shymean 2016 - 2017
            <a href="http://www.miitbeian.gov.cn" rel="nofollow" target="_blank" style="display:inline-block;">粤ICP备17060238号-1</a>
        </p>
    </div>
    <div class="hide-xs">
        <script src="https://s19.cnzz.com/z_stat.php?id=1264491168&amp;web_id=1264491168" language="JavaScript"></script>
    </div>
</footer>

</div>

</body>
</html>