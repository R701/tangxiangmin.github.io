<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <link rel="stylesheet" href="/css/blog.css">
    <link rel="stylesheet" href="/css/fonts/iconfont.css">
    <!--<link rel="stylesheet" href="//cdn.bootcss.com/highlight.js/9.2.0/styles/github.min.css">-->
    <link rel="stylesheet" href="//cdn.bootcss.com/fancybox/3.1.25/jquery.fancybox.min.css">
    <script src="/js/require.js" data-main="/js/main"></script>
</head>
<body>
<div id="blog" class="page page-theme-base" v-cloak>
    <blog-header></blog-header>
    <header class="page_hd" data-v-04342fbc="">
    <div class="container header" data-v-04342fbc="">
        <h1 class="logo" data-v-04342fbc="">
            <a href="/" class="nuxt-link-exact-active nuxt-link-active" data-v-04342fbc="">橙红年代</a>
        </h1>
        <div class="show-md" data-v-04342fbc="">
            <div class="btn-list" data-v-04342fbc="">
                <div class="btn-icon" data-v-04342fbc="">
                    <span class="btn-line" data-v-04342fbc=""></span>
                    <span class="btn-line" data-v-04342fbc=""></span>
                    <span class="btn-line" data-v-04342fbc=""></span>
                </div>
            </div>
        </div>
        <nav class="nav-responsive" data-v-04342fbc="">
            
            <a class="nav_item" href="/">首页</a>
            
            <a class="nav_item" href="/archives">归档</a>
            
            <a class="nav_item" href="/tags">标签</a>
            
        </nav>
    </div>
</header>
    <main class="page_mn" >
        <div class="container">
            <article class="article article-detail">
    <header class="text-center">
        <h2 class="article_hd">初识weex</h2>
        <div class="article_info">
            <span class="hide-sm">发表于</span>
            <span class="show-sm">
                <i class="iconfont icon-archives"></i>
            </span>
            <time>2018/1/14 22:07:32</time>
            |
            <span class="hide-sm">分类于</span>
            <span class="show-sm"><i class="iconfont icon-tag"></i></span>
            
                <a href="/categories/JavaScript" class="hover-highlight">JavaScript</a>
            

        </div>
    </header>
    <div class="article_ct">
        <p>现在公司的项目是基于weex开发的，我负责的前端业务也是采用Vue，早先学了点Android的东西，前段时间一直在学习Vue的源码，于是现在打算来理一理weex相关的知识，后面也可以跟客户端的同学探讨一下。</p>
<a id="more"></a>
<p>参考：</p>
<ul>
<li><a href="http://weex.apache.org/cn/references/" target="_blank" rel="external">weex官方文档</a>，文档有点粗糙</li>
</ul>
<ul>
<li><a href="http://www.open-open.com/lib/view/1484708363305" target="_blank" rel="external">Weex初体验–创建一个简单的Weex程序</a></li>
<li><a href="http://imweb.io/topic/59355fdec99e696d3ab4d916" target="_blank" rel="external">可能是史上最全的weex踩坑攻略</a>，这个可以避免很多坑，强烈推荐</li>
</ul>
<h2 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h2><h3 id="开发环境"><a href="#开发环境" class="headerlink" title="开发环境"></a>开发环境</h3><p><strong>踩坑记</strong></p>
<p>npm大法好，全局安装<code>weex-toolkit</code>即可。使用<code>weex -v</code>查看版本：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">  v1.1.0-beta.7</div><div class="line">- weexpack : v0.4.7-beta.26</div><div class="line">- weex-builder : v0.2.13-beta.4</div><div class="line">- weex-previewer : v1.3.13-beta.10</div></pre></td></tr></table></figure>
<p>由于初学，也不需要使用<code>weex init</code>创建项目，下面开箱即食</p>
<ul>
<li>新建目录</li>
<li>新建<code>demo1.we</code>文件，打开<a href="http://weex.apache.org/cn/references/components/a.html" target="_blank" rel="external">内置组件文档</a>，复制个官方demo进去</li>
<li><code>weex demo1.we</code>文件，然后就可以在浏览中预览文件了</li>
</ul>
<p>会发现<code>.we</code>文件和<code>.vue</code>文件的格式貌似是一模一样的~打开万能的webstrom，会提示安装<code>*.we</code>文件插件，找到<code>weex</code>插件，然后安装，即可以在侧边栏直接预览页面（这让我想起了HBuilder，然而侧边栏调试并没有浏览器中好用~），总之有代码提示和语法高亮就够了。</p>
<p>上面的过程非常简单，然而我却跳进了一个坑：为了测试内置组件（比如<code>text</code>），新建了一个<code>text.we</code>，然后执行<code>weex text.we</code>，在控制台会发现堆栈溢出了~，去搜issue才发现原来是<strong>we文件命名与web组件名相同导致的</strong>。</p>
<p>然后又测试了事件绑定，文档上面采用的是Vue的<code>@click=&quot;handleClick&quot;</code>这样的简写方法，但是我在web下测试会报错</p>
<blockquote>
<p>@change’ is not a valid attribute name</p>
</blockquote>
<p><del>需要调整成<code>onclick=&quot;handleClick&quot;</code>这样的形式，是不是我版本的问题</del>。然后查了半天没找到如何查看weex的版本，貌似<code>weex-toolkit</code>和<code>weex</code>版本是独立的。后来发现在控制台输出<code>weex.config</code>才发现，<code>weexVersion</code>才<code>v0.5.0</code>，所以说，这个内置的预览不靠谱，上面这趟的这些坑都是脑子进的水，老老实实建个新项目吧。</p>
<p><strong>开发环境</strong></p>
<p>weex内置了一套开发环境</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">npm run dev &amp; npm run serve</div></pre></td></tr></table></figure>
<p>查看<code>webpack.config.js</code>可以发现，实际存在<code>webConfig</code>和<code>weexConfig</code>两套配置，这是因为在打包的时候，客户端使用<code>weex-loader</code>进行处理，而web端使用<code>vue-loader</code>进行处理。</p>
<p>在<code>webpack.dev.js</code>开发模式下，使用的是<code>webConfig</code>。这里还有不少坑（比如自动生成的入口文件），后面会提到</p>
<h3 id="Android环境"><a href="#Android环境" class="headerlink" title="Android环境"></a>Android环境</h3><p>由于目前iOS方面我只是了解一点点基本语法，因此先从Android开始学习，后面再进行iOS相关的处理。</p>
<p>根据官方文档的要求，搭建对应版本的android环境，添加相关依赖</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">compile</span> <span class="string">'com.android.support:recyclerview-v7:25.3.0'</span></div><div class="line"><span class="keyword">compile</span> <span class="string">'com.android.support:appcompat-v7:25.1.1'</span></div><div class="line"><span class="keyword">compile</span> <span class="string">'com.alibaba:fastjson:1.1.45'</span></div><div class="line"><span class="keyword">compile</span> <span class="string">'com.taobao.android:weex_sdk:0.9.5@aar'</span></div><div class="line"><span class="keyword">compile</span> <span class="string">'com.github.bumptech.glide:glide:3.7.0'</span></div></pre></td></tr></table></figure>
<p><strong>ImageAdapter</strong></p>
<p>这里我选择使用了<code>Glide</code>实现图片的加载</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ImageAdapter</span> <span class="keyword">implements</span> <span class="title">IWXImgLoaderAdapter</span> </span>&#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setImage</span><span class="params">(String url, ImageView view, WXImageQuality quality, WXImageStrategy strategy)</span> </span>&#123;</div><div class="line">        Glide.with(view.getContext())</div><div class="line">                .load(url)</div><div class="line">                .into(view);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><strong>实现自定义Application</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">Application</span> </span>&#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onCreate();</div><div class="line">        InitConfig config=<span class="keyword">new</span> InitConfig.Builder().setImgAdapter(<span class="keyword">new</span> ImageAdapter()).build();</div><div class="line">        WXSDKEngine.initialize(<span class="keyword">this</span>,config);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>记得一定要在<code>manifests</code>中设置自定义的application</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">application</span></span></div><div class="line"><span class="tag">       <span class="attr">android:name</span>=<span class="string">".App"</span> // 这个一定要加上</span></div><div class="line"><span class="tag">&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">application</span>&gt;</span></div></pre></td></tr></table></figure>
<p><strong>加载对应的js文件</strong></p>
<p>执行<code>npm run build</code>之后打包获得的JS文件位于<code>dist/index.js</code>，将其拷贝到Android项目的<code>assets</code>目录下。<del>由于操作比较频繁可以定义一个脚本</del>，直接加载服务器资源即可</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">"scripts": &#123;</div><div class="line">  "copy:android": "cp dist/index.js ../android/app/src/main/assets/index.js"</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>然后在对应活动中通过实例化<code>WXSDKInstance</code>对象</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</div><div class="line">        requestWindowFeature(Window.FEATURE_NO_TITLE);</div><div class="line">        mWXSDKInstance = <span class="keyword">new</span> WXSDKInstance(<span class="keyword">this</span>);</div><div class="line">        mWXSDKInstance.registerRenderListener(<span class="keyword">this</span>);</div><div class="line">        <span class="comment">// mWXSDKInstance.render("WXSample", WXFileUtils.loadAsset("index.js",this), null, null, -1, -1, WXRenderStrategy.APPEND_ASYNC);</span></div><div class="line">  		mWXSDKInstance.renderByUrl(<span class="string">"WXSample"</span>, <span class="string">"http://10.0.2.2:8081/dist/index.js"</span>, <span class="keyword">null</span>, <span class="keyword">null</span>, -<span class="number">1</span>, -<span class="number">1</span>, WXRenderStrategy</div><div class="line">                .APPEND_ASYNC);</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p>其中<code>8081</code>是weex脚手架开启的服务器，记得在<code>manifests</code>中配置网络权限。在项目中更常用的做法是加载服务器上的JS文件，实现客户端的热更新，这里涉及到一系列的缓存问题，我们先把demo跑起来</p>
<h2 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h2><h3 id="样式"><a href="#样式" class="headerlink" title="样式"></a>样式</h3><p>由于在打包时会将css转换成对应的json语法，加之官方文档解释为了提高解析性能，因此与传统的CSS还是有一些区别的。下面是几个需要注意的地方</p>
<ul>
<li>部分样式都不支持简写，如<code>border</code>，<code>background</code></li>
<li><code>position</code>不支持<code>z-index</code>，默认靠后的元素层级较高</li>
<li>文本样式不支持继承，后代选择器无效</li>
<li>默认以<code>750 * 1334</code>尺寸，跟小程序的rpx单位比较相似。这导致在浏览器已像素预览正常，而在客户端发现所有尺寸都小了一倍</li>
<li><code>transform</code>和<code>transiton</code>的支持有限</li>
</ul>
<h3 id="组件"><a href="#组件" class="headerlink" title="组件"></a>组件</h3><p>weex内置了一些组件</p>
<ul>
<li><code>div</code>中不能直接添加文本，文本只能在<code>text</code>中添加。官方建议div嵌套不宜过深</li>
<li>a链接只是默认调用了event模块的<code>openURL</code>，却没有实现相关的方法，所以需要自己实现<code>WXEventModule</code>并注册</li>
<li>Android下默认<code>overflow:hidden</code>，为了实现内容滚动只能使用<code>scroller</code>组件</li>
<li><a href="https://weex.apache.org/cn/references/components/image.html" target="_blank" rel="external">image</a>用来加载图片，需要原生实现图片加载器，且需要<strong>在样式中手动设置宽高</strong>，否则不会显示图片。image组件的功能比较强大，包括占位图和下载图片等</li>
<li><a href="https://weex.apache.org/cn/references/components/web.html" target="_blank" rel="external">web</a>组件用来加载网页，可以使用<code>webview</code>内置模块来控制webview的行为，不过功能比较弱，暂时没有找到对webview组件相关设置（如允许弹窗等）</li>
</ul>
<h3 id="模块"><a href="#模块" class="headerlink" title="模块"></a>模块</h3><p>weex内置了一些模块，用于封装底层的api，下面先介绍了几个比较常用的模块</p>
<ul>
<li><code>model</code>模块用于提供与原生类似的模态框</li>
</ul>
<ul>
<li><code>navigator</code>模块用于控制weex页面的跳转，在下面的路由章节中有对该模块的使用</li>
<li><code>stream</code>模块提供了网络请求相关接口</li>
</ul>
<p>大部分模块使用的是回调函数形式，我们可以对其封装，使其Promise化。比如下面对于stream模块的封装</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> stream = weex.requireModule(<span class="string">'stream'</span>)</div><div class="line"><span class="keyword">let</span> baseUrl = <span class="string">'http://10.0.2.2:9999/'</span></div><div class="line"></div><div class="line"><span class="keyword">let</span> get = <span class="function"><span class="keyword">function</span>(<span class="params">url</span>)</span>&#123;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>)=&gt;</span>&#123;</div><div class="line">        stream.fetch(&#123;</div><div class="line">            method: <span class="string">'GET'</span>,</div><div class="line">            url: baseUrl+url,</div><div class="line">            type:<span class="string">'json'</span></div><div class="line">        &#125;, <span class="function"><span class="keyword">function</span>(<span class="params">ret</span>) </span>&#123;</div><div class="line">            <span class="keyword">if</span>(!ret.ok)&#123;</div><div class="line">                reject(ret)</div><div class="line">            &#125;<span class="keyword">else</span>&#123;</div><div class="line">                <span class="keyword">let</span> data = ret.data;</div><div class="line">                resolve(data)</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">    &#125;)</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</div><div class="line">    get</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>在下面的原生交互章节再去了解实现自定义模块和组件。</p>
<h2 id="开发环境-1"><a href="#开发环境-1" class="headerlink" title="开发环境"></a>开发环境</h2><h3 id="样式表"><a href="#样式表" class="headerlink" title="样式表"></a>样式表</h3><p><strong>预编译器</strong><br>在<code>style</code>上添加<code>lang=&quot;scss&quot;</code>指定css语法，但是在build会报错</p>
<blockquote>
<p>Module not found: Error: Can’t resolve ‘scss-loader’</p>
</blockquote>
<p>解决办法是将<code>lang=&quot;sass&quot;</code>，然后<code>@import &#39;./index.scss&#39;</code></p>
<p><strong>字体图标</strong></p>
<p>在之前的微信小程序项目中，通过将ttf字体转换成base64文件，然后引入样式表中就可以愉快地使用字体图标了。</p>
<p>但是在weex中不支持这种形式，其原因是不支持<code>after</code>伪元素，直接引入字体然后在<code>text</code>组件中使用对应的字体编码是可以渲染的~这个就很蛋疼了</p>
<p>关于字体图标的使用，这里有一个<a href="https://segmentfault.com/q/1010000009357817/a-1020000009375587" target="_blank" rel="external">讨论</a></p>
<h3 id="服务器"><a href="#服务器" class="headerlink" title="服务器"></a>服务器</h3><p>为了方便测试，我使用的是Koa搭建静态资源和接口服务器，位于<code>/server</code>下，服务器主要用于提供静态资源（如图标）和数据接口。</p>
<p>在开发的时候，使用的是<code>npm run server</code>开启的express服务器，这样可以方便同步查看效果。在项目上线的时候，也需要将<code>JSBundle</code>部署到静态资源服务器上</p>
<h3 id="模块化"><a href="#模块化" class="headerlink" title="模块化"></a>模块化</h3><p>由于使用webpack进行打包，因此我们可以很方便地使用CommonJS或ES6模块来组织代码，常见的比如网络请求、路径配置等功能，都可以按照具体业务需求进行模块化处理</p>
<h2 id="路由"><a href="#路由" class="headerlink" title="路由"></a>路由</h2><p>Weex推荐使用单页独立开发的，即每个vue文件对应一个页面，在<code>build</code>的时候会将每个vue文件都打包成对应的<code>JSBundle</code>文件（在<code>webpack.config.js</code>中可以看见其原理是遍历<code>/src</code>文件夹）。这样可以使页面更加精简，方便维护和增量更新。</p>
<p>这是否意味着官方不建议使用<code>vue-router</code>来实现页面跳转呢~</p>
<h3 id="native-gt-weex"><a href="#native-gt-weex" class="headerlink" title="native-&gt;weex"></a>native-&gt;weex</h3><p>由于weex页面可以作为单个组件嵌入应用，因此原生跳转到weex页面，实际上就是原生之之间的跳转，在Andorid中，通过<code>startActivity</code>来实现页面跳转。</p>
<h3 id="weex-gt-native"><a href="#weex-gt-native" class="headerlink" title="weex-&gt;native"></a>weex-&gt;native</h3><p>// todo</p>
<h3 id="weex-gt-weex"><a href="#weex-gt-weex" class="headerlink" title="weex-&gt;weex"></a>weex-&gt;weex</h3><p>weex内置了<code>navigator</code>模块，用来实现<code>weex</code>页面与<code>weex</code>页面之间的跳转。</p>
<p>其原理是通过拦截器，来确定需要显示的<code>Activity</code>，然后加载对应的<code>JSBundle</code>资源，渲染weex页面。具体的使用可以参考<a href="http://blog.csdn.net/violetjack0808/article/details/74390249" target="_blank" rel="external">这里</a></p>
<p><strong>声明拦截器</strong></p>
<p>声明一个用于处理weex跳转的<a href="https://developer.android.com/guide/components/intents-filters.html?hl=zh-cn" target="_blank" rel="external">拦截器</a></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">activity</span></span></div><div class="line"><span class="tag">	<span class="attr">android:name</span>=<span class="string">".WeexActivity"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">intent-filter</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">"com.taobao.android.intent.action.WEEX"</span> /&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">category</span> <span class="attr">android:name</span>=<span class="string">"android.intent.category.DEFAULT"</span> /&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">category</span> <span class="attr">android:name</span>=<span class="string">"com.taobao.android.intent.category.WEEX"</span> /&gt;</span></div><div class="line"></div><div class="line">        <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">"android.intent.action.VIEW"</span> /&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">data</span> <span class="attr">android:scheme</span>=<span class="string">"http"</span> /&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">data</span> <span class="attr">android:scheme</span>=<span class="string">"https"</span> /&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">data</span> <span class="attr">android:scheme</span>=<span class="string">"file"</span> /&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">data</span> <span class="attr">android:scheme</span>=<span class="string">"wxpage"</span> /&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">activity</span>&gt;</span></div></pre></td></tr></table></figure>
<p><strong>声明活动</strong></p>
<p>这里专门新建了一个Activity处理weex页面的跳转，实际上也可以在同一个Activity内处理。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WeexActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> <span class="keyword">implements</span> <span class="title">IWXRenderListener</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String TEST_URL = <span class="string">"http://10.0.2.2:8081/dist/index.js"</span>;</div><div class="line">    <span class="keyword">private</span> WXSDKInstance mWXSDKInstance;</div><div class="line">    <span class="keyword">private</span> FrameLayout mContainer;</div><div class="line">    <span class="keyword">private</span> Uri mUri;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</div><div class="line">        setContentView(R.layout.activity_weex);</div><div class="line"></div><div class="line">        mContainer = (FrameLayout) findViewById(R.id.container);</div><div class="line"></div><div class="line">        mWXSDKInstance = <span class="keyword">new</span> WXSDKInstance(<span class="keyword">this</span>);</div><div class="line">        mWXSDKInstance.registerRenderListener(<span class="keyword">this</span>);</div><div class="line">        String url = <span class="keyword">this</span>.getJSPath();</div><div class="line"></div><div class="line">        <span class="keyword">if</span> (url.isEmpty())&#123;</div><div class="line">            url = TEST_URL;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        HashMap&lt;String, Object&gt; options = <span class="keyword">this</span>.getWeexOpts(url);</div><div class="line">	</div><div class="line">        mWXSDKInstance.renderByUrl(<span class="string">"WXSample"</span>, url,options,<span class="keyword">null</span>, WXRenderStrategy.APPEND_ONCE);</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">private</span> HashMap&lt;String, Object&gt; <span class="title">getWeexOpts</span><span class="params">(String jsPath)</span></span>&#123;</div><div class="line">        HashMap&lt;String, Object&gt; options = <span class="keyword">new</span> HashMap&lt;String, Object&gt;();</div><div class="line">        options.put(WXSDKInstance.BUNDLE_URL, jsPath);</div><div class="line">        <span class="keyword">return</span> options;</div><div class="line">    &#125;</div><div class="line">    <span class="comment">// 从intent中获取js地址</span></div><div class="line">    <span class="function"><span class="keyword">private</span> String <span class="title">getJSPath</span><span class="params">()</span></span>&#123;</div><div class="line">        Uri uri = getIntent().getData();</div><div class="line">        Bundle bundle = getIntent().getExtras();</div><div class="line"></div><div class="line">        <span class="keyword">if</span> (uri != <span class="keyword">null</span>) &#123;</div><div class="line">            mUri = uri;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">if</span> (bundle != <span class="keyword">null</span>) &#123;</div><div class="line">            String bundleUrl = bundle.getString(<span class="string">"bundleUrl"</span>);</div><div class="line">            <span class="keyword">if</span> (!TextUtils.isEmpty(bundleUrl)) &#123;</div><div class="line">                mUri = Uri.parse(bundleUrl);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">return</span> mUri.toString();</div><div class="line">    &#125;</div><div class="line">    <span class="comment">// ...</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="原生交互"><a href="#原生交互" class="headerlink" title="原生交互"></a>原生交互</h2><p>weex提供了实现原生扩展的接口，包括模块扩展和组件扩展，参考<a href="https://weex.apache.org/cn/guide/extend-android.html" target="_blank" rel="external">文档</a></p>
<h3 id="模块扩展"><a href="#模块扩展" class="headerlink" title="模块扩展"></a>模块扩展</h3><p>实现在原生实现相关的模块</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyModule</span> <span class="keyword">extends</span> <span class="title">WXModule</span> </span>&#123;</div><div class="line">    <span class="meta">@JSMethod</span>(uiThread = <span class="keyword">true</span>)</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">showToast</span><span class="params">(String msg)</span></span>&#123;</div><div class="line">        Toast.makeText(mWXSDKInstance.getContext(),msg,Toast.LENGTH_LONG).show();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>然后在自定义application中注册模块</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">Application</span> </span>&#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onCreate();</div><div class="line">        InitConfig config=<span class="keyword">new</span> InitConfig.Builder().setImgAdapter(<span class="keyword">new</span> ImageAdapter()).build();</div><div class="line">        WXSDKEngine.initialize(<span class="keyword">this</span>,config);</div><div class="line">		<span class="comment">// 注册相关模块</span></div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            WXSDKEngine.registerModule(<span class="string">"myModule"</span>, MyModule.class);</div><div class="line">        &#125;<span class="keyword">catch</span> (WXException e)&#123;</div><div class="line">            e.printStackTrace();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>然后在weex中引用相关模块，其中通过模块名进行关联</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">weex.requireModule(<span class="string">'@weex-module/myModule'</span>).showToast(<span class="string">'Hello Native'</span>)</div></pre></td></tr></table></figure>
<p>这里遇见的一个问题是模块注册失败，一查发现有不少类似的<a href="https://github.com/alibaba/weex/issues/1200" target="_blank" rel="external">问题</a>。</p>
<h3 id="自定义组件"><a href="#自定义组件" class="headerlink" title="自定义组件"></a>自定义组件</h3><p>weex支持Vue的组件系统，此外，还支持通过原生扩展的组件系统，这里暂时没有进一步了解</p>
<h2 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h2><p>经过一段时间的折腾，自己体会到了weex的一些优点和劣势：</p>
<ul>
<li>优点自然是跨平台，极大程度上降低开发成本</li>
<li>劣势是在三端的表现都如原生，且内置的功能有限；深入开发的成本也不低，还需要处理不同平台的差异，可能会提高后续维护成本</li>
</ul>
<p>实际上我是在之前阅读Vue源码的时候，看见在渲染函数中生成的AST，在不同的运行平台下有不一样的处理方式，于是来了解下weex。后面有时间应该会去尝试下<code>React Native</code>。</p>
<p>感觉这种跨平台构建前端应用是未来前端的发展趋势（包括微信小程序这种），因此还是应该围观一下。</p>

    </div>
    <footer class="article_ft">
        
        <a href="/tags/vue" class="article_tag">#vue</a>
        
        <a href="/tags/weex" class="article_tag">#weex</a>
        
    </footer>

    <div class="article_nav"><a href="/article/mockjs使用心得" class="hover-highlight article_prev">mockjs使用心得</a><a
                href="/article/博客SSR实践总结" class="hover-highlight article_next">博客SSR实践总结</a></div>
</article>
        </div>
    </main>

    <aside>
    <div class="page_sd hide-md">
        <div class="tab">
            <!---->
            
            <ul class="tab_nav">
                <li class="tab_item active" data-target="#J_toc">
                    文章目录
                </li>
                <li class="tab_item" data-target="#J_profile">
                    站点资料
                </li>
            </ul>
            <div class="tab_panel active" id="J_toc">
                <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#环境"><span class="toc-number">1.</span> <span class="toc-text">环境</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#开发环境"><span class="toc-number">1.1.</span> <span class="toc-text">开发环境</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Android环境"><span class="toc-number">1.2.</span> <span class="toc-text">Android环境</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#语法"><span class="toc-number">2.</span> <span class="toc-text">语法</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#样式"><span class="toc-number">2.1.</span> <span class="toc-text">样式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#组件"><span class="toc-number">2.2.</span> <span class="toc-text">组件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#模块"><span class="toc-number">2.3.</span> <span class="toc-text">模块</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#开发环境-1"><span class="toc-number">3.</span> <span class="toc-text">开发环境</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#样式表"><span class="toc-number">3.1.</span> <span class="toc-text">样式表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#服务器"><span class="toc-number">3.2.</span> <span class="toc-text">服务器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#模块化"><span class="toc-number">3.3.</span> <span class="toc-text">模块化</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#路由"><span class="toc-number">4.</span> <span class="toc-text">路由</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#native-gt-weex"><span class="toc-number">4.1.</span> <span class="toc-text">native->weex</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#weex-gt-native"><span class="toc-number">4.2.</span> <span class="toc-text">weex->native</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#weex-gt-weex"><span class="toc-number">4.3.</span> <span class="toc-text">weex->weex</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#原生交互"><span class="toc-number">5.</span> <span class="toc-text">原生交互</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#模块扩展"><span class="toc-number">5.1.</span> <span class="toc-text">模块扩展</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#自定义组件"><span class="toc-number">5.2.</span> <span class="toc-text">自定义组件</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#小结"><span class="toc-number">6.</span> <span class="toc-text">小结</span></a></li></ol>
            </div>
            
            <div class="tab_panel " id="J_profile">
                <div>
                    <div class="me">
                        <img src="http://shymean.com/_nuxt/img/head.dd612ee.jpg" alt="shymean" width="100" height="100">
                        <h3>shymean</h3>
                        <p>一个不学无术且无趣的人。</p>
                    </div>
                    <div class="nav-border">
                        <a href="/book" class="nav_item">
                            <i class="iconfont icon-bookshelf"></i>
                            <br>书架
                        </a>
                        <a href="/message" class="nav_item">
                            <i class="iconfont icon-comment"></i>
                            <br>留言
                        </a>
                        <a href="/about" class="nav_item">
                            <i class="iconfont icon-info"></i>
                            <br>关于
                        </a>
                    </div>
                    <div class="contact">
                        <a href="https://github.com/tangxiangmin" target="_blank" class="contact_link">
                            <i class="iconfont icon-github"></i> GitHub</a>
                        <a href="http://wpa.qq.com/msgrd?v=3&amp;uin=645234650&amp;site=qq&amp;menu=yes"
                            target="_blank" class="contact_link">
                            <i class="iconfont icon-qq"></i> QQ</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="tool">
        <div class="btn-list hide-md" id="J_toggleSide">
            <div class="btn-icon">
                <span class="btn-line"></span>
                <span class="btn-line"></span>
                <span class="btn-line"></span>
            </div>
        </div>
        <div class="btn-top">
            <i class="iconfont icon-top"></i>
        </div>
    </div>
</aside>
    <footer class="page_ft">
    <div class="container footer">
        <p>世人的悲欢并不相通，我只是觉得他们吵闹。</p>
        <p>
            Copyright © Shymean 2016 - 2017
            <a href="http://www.miitbeian.gov.cn" rel="nofollow" target="_blank" style="display:inline-block;">粤ICP备17060238号-1</a>
        </p>
    </div>
    <div class="hide-xs">
        <script src="https://s19.cnzz.com/z_stat.php?id=1264491168&amp;web_id=1264491168" language="JavaScript"></script>
    </div>
</footer>

</div>

</body>
</html>