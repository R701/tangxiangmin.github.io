<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <link rel="stylesheet" href="/css/blog.css">
    <link rel="stylesheet" href="/css/fonts/iconfont.css">
    <!--<link rel="stylesheet" href="//cdn.bootcss.com/highlight.js/9.2.0/styles/github.min.css">-->
    <link rel="stylesheet" href="//cdn.bootcss.com/fancybox/3.1.25/jquery.fancybox.min.css">
    <script src="/js/require.js" data-main="/js/main"></script>
</head>
<body>
<div id="blog" class="page page-theme-base" v-cloak>
    <blog-header></blog-header>
    <header class="page_hd" data-v-04342fbc="">
    <div class="container header" data-v-04342fbc="">
        <h1 class="logo" data-v-04342fbc="">
            <a href="/" class="nuxt-link-exact-active nuxt-link-active" data-v-04342fbc="">橙红年代</a>
        </h1>
        <div class="show-md" data-v-04342fbc="">
            <div class="btn-list" data-v-04342fbc="">
                <div class="btn-icon" data-v-04342fbc="">
                    <span class="btn-line" data-v-04342fbc=""></span>
                    <span class="btn-line" data-v-04342fbc=""></span>
                    <span class="btn-line" data-v-04342fbc=""></span>
                </div>
            </div>
        </div>
        <nav class="nav-responsive" data-v-04342fbc="">
            
            <a class="nav_item" href="/">首页</a>
            
            <a class="nav_item" href="/archives">归档</a>
            
            <a class="nav_item" href="/tags">标签</a>
            
            <a class="nav_item" href="/test">Test</a>
            
        </nav>
    </div>
</header>
    <main class="page_mn" >
        <div class="container">
            <article class="article article-detail">
    <header class="text-center">
        <h2 class="article_hd">正则表达式之捕获</h2>
        <div class="article_info">
            <span class="hide-sm">发表于</span>
            <span class="show-sm">
                <i class="iconfont icon-archives"></i>
            </span>
            <time>2016/9/26 22:25:53</time>
            |
            <span class="hide-sm">分类于</span>
            <span class="show-sm"><i class="iconfont icon-tag"></i></span>
            
                <a href="/categories/JavaScript" class="hover-highlight">JavaScript</a>
            

        </div>
    </header>
    <div class="article_ct">
        <p>最近刚好搞定CSS选择器命名的问题（勉强能够心平气和的写样式表，姑且算作是解决了一个疑问吧），然后开始阅读jQuery源码，虽然很早之前就曾经打开看过，当时看见弟六十几行定义的几个正则，然后一脸蒙蔽，悻悻然关闭了编辑器。然而，jQuery源码迟早是要读的，正则也是必须要掌握的，最重要的一点是：并没有什么知识是不可能学会的！既然如此，那就先从正则入手吧。<br><a id="more"></a></p>
<h2 id="exec-方法"><a href="#exec-方法" class="headerlink" title="exec()方法"></a>exec()方法</h2><p>jQuery前面定义的这几个正则用来进行快速匹配和单标签匹配：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">rquickExpr = <span class="regexp">/^(?:\s*(&lt;[\w\W]+&gt;)[^&gt;]*|#([\w-]*))$/</span>,</div><div class="line">rsingleTag = <span class="regexp">/^&lt;(\w+)\s*\/?&gt;(?:&lt;\/\1&gt;|)$/</span>,</div></pre></td></tr></table></figure></p>
<p>可以看见中间的(?:)。那么，这个带括号的问号究竟是什么呢？经过一番折腾，终于对正则表达式的<strong>“捕获”</strong>有了一点认识。这是参考的<a href="http://www.cnblogs.com/yakun/p/3795589.html" target="_blank" rel="external">一篇文章</a>。<br>在前面的<a href="https://tangxiangmin.github.io/2016/07/18/%E5%88%9D%E8%AF%86%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/" target="_blank" rel="external">《初识正则表达式》</a>这篇文章中，对于小括号的作用只是进行了简单的描述：改变限定符的作用范围和分组<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 改变作用域范围</span></div><div class="line"><span class="keyword">var</span> re1 = <span class="regexp">/(a|b)c/</span>;</div><div class="line"><span class="comment">// 分组</span></div><div class="line"><span class="keyword">var</span> re2 = <span class="regexp">/(ab)&#123;2&#125;c/</span>;</div></pre></td></tr></table></figure></p>
<p>这里的分组，实际上是创建子表达式，提到子表达式，就不得不再提到一个更重要的正则对象方法：exec()。exec()方法用来返回字符串中符合对应正则表达式的子字符串。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">var re = /\d&#123;2&#125;/;</div><div class="line">console.log(re.exec(&quot;asd78aa&quot;));//[&quot;78&quot;, index: 3, input: &quot;asd78ss&quot;]</div><div class="line">console.log(re.exec(&quot;asdaa));//null</div></pre></td></tr></table></figure></p>
<p>可以看见，如果匹配成功，实际上exec返回的是一个数组arr，arr[0]表示所匹配到的文本，index表示该文本的索引值，input即为原字符串。但是，这个返回值并不仅仅有这些属性，如果正则表达式中存在子表达式的时候：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> re = <span class="regexp">/(\d&#123;2&#125;)aa/</span>;</div><div class="line"><span class="built_in">console</span>.log(re.exec(<span class="string">"asd78aa"</span>));<span class="comment">//["78aa", "78", index: 3, input: "asd78aa"]</span></div></pre></td></tr></table></figure></p>
<p>则对应的arr[1]为正则表达式中第一个子表达式所匹配到的值，如果存在多个子表达式（也就是多个分组括号），则从左到右依次将子表达式所匹配到的文本存放在对应索引值位置<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//从arr[1]开始，依次存放子表达式匹配值</span></div><div class="line"><span class="keyword">var</span> re1 = <span class="regexp">/(\d&#123;2&#125;)(aa)/</span>;</div><div class="line"><span class="built_in">console</span>.log(re1.exec(<span class="string">"asd78aa"</span>));<span class="comment">//["78aa", "78", "aa", index: 3, input: "asd78aa"]</span></div><div class="line"></div><div class="line"><span class="comment">// 嵌套情况下也是从左到右</span></div><div class="line"><span class="keyword">var</span> re2 = <span class="regexp">/(\d&#123;2&#125;(xyz))aa/</span>;</div><div class="line"><span class="built_in">console</span>.log(re2.exec(<span class="string">"asd78xyzaa"</span>));<span class="comment">//["78xyzaa", "78xyz", "xyz", index: 3, input: "asd78xyzaa"]</span></div><div class="line"></div><div class="line"><span class="comment">// undefined</span></div><div class="line"><span class="keyword">var</span> re3 = <span class="regexp">/(\d&#123;2&#125;)|(xyz)/</span>;</div><div class="line"><span class="built_in">console</span>.log(re3.exec(<span class="string">"asd78xyz"</span>));<span class="comment">//["78", "78", undefined, index: 3, input: "asd78aaxyz"]</span></div></pre></td></tr></table></figure></p>
<p>上面的undefined是什么鬼？这是因此没有设置全局模式的缘故，第一次返回匹配结果(78)的时候，并没有匹配到第二个子字符串(xyz)的文本，因此使用undefined进行填充（注意，这里是理解捕获与非捕获十分重要的一点，也就是说，实际上无论匹配是否成功，默认都会对对应索引值元素进行填充）。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//加上全局模式</span></div><div class="line"><span class="keyword">var</span> re3 = <span class="regexp">/(\d&#123;2&#125;)|(xyz)/g</span>;</div><div class="line"><span class="built_in">console</span>.log(re3.exec(<span class="string">"asd78xyz"</span>));<span class="comment">//["78", "78", undefined, index: 3, input: "asd78xyz"]</span></div><div class="line"><span class="built_in">console</span>.log(re3.exec(<span class="string">"asd78xyz"</span>));<span class="comment">//["xyz", undefined, "xyz", index: 5, input: "asd78xyz"]</span></div><div class="line"><span class="built_in">console</span>.log(re3.exec(<span class="string">"asd78xyz"</span>));<span class="comment">//null</span></div><div class="line"><span class="comment">//此时lastindex重置为0</span></div><div class="line"><span class="built_in">console</span>.log(re3.exec(<span class="string">"asd78xyz"</span>));<span class="comment">//["78", "78", undefined, index: 3, input: "asd78xyz"]</span></div></pre></td></tr></table></figure></p>
<p>也就是说，可以通过判断返回结果是否为null，可以获取整个字符串中完整模式匹配信息。</p>
<h2 id="捕获"><a href="#捕获" class="headerlink" title="捕获"></a>捕获</h2><h3 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h3><p>使用小括号指定一个子表达式后，匹配这个子表达式的文本（即匹配的内容，也就是上面的arr[1],arr[2]…的值）可以在表达式或者其他过程中进一步进行处理，这个大概就是捕获的定义。<br>所谓的进一步处理，实际上是使用子表达式的结果来限定实际正则表达式（整个正则表达式）的输出结果（限定这个词是我自己理解所想到的词儿，若有错误还请指正）。这些限定包括：非捕获组(?:)，前查找(?=)，后查找(?&lt;=)。</p>
<h3 id="非捕获组"><a href="#非捕获组" class="headerlink" title="非捕获组"></a>非捕获组</h3><p>在某些情况下：比如需要使用某个限制条件匹配正则，但是又不希望在输出结果中看键这个限制条件。这时，就可以使用非捕获分组来达到这种效果。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> re = <span class="regexp">/(?:\d&#123;2&#125;)xyz/g</span>;</div><div class="line"><span class="built_in">console</span>.log(re.exec(<span class="string">"asd78xyz"</span>));<span class="comment">//["78xyz", index: 3, input: "asd78xyz"]</span></div></pre></td></tr></table></figure></p>
<p>可以看见，虽然存在子表达式(\d{2})，但是并没有在exec()输出结果中看见该子表达式对应的匹配（前面提到，即使没有匹配到结果，也会使用undefined进行占位）。使用非捕获组的用途，大概就是为了去除输出结果中无效的undefined的吧（有可能不是这么回事儿）。</p>
<h3 id="前查找"><a href="#前查找" class="headerlink" title="前查找"></a>前查找</h3><p>仍然考虑一种情况：我们需要匹配的目标字符串，是通过其后面的文本特征进行匹配的（比如找到后三位是xyz的目标文本）。这种情况下就可以使用前查找(?=)。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> re = <span class="regexp">/\d&#123;2&#125;(?=xyz)/g</span>;</div><div class="line"><span class="built_in">console</span>.log(re.exec(<span class="string">"asd78xyz"</span>));<span class="comment">//["78", index: 3, input: "asd78xyz"]</span></div></pre></td></tr></table></figure></p>
<p>如果是连续的字符串匹配会发生什么情况呢？<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> re = <span class="regexp">/xyz(?=xyz)/g</span>,result;</div><div class="line"><span class="keyword">while</span> ((result= re.exec(<span class="string">"asd78xyzxyzxyzxyz"</span>)) != <span class="literal">null</span>) &#123;</div><div class="line">    <span class="built_in">console</span>.log(result);</div><div class="line">    <span class="comment">//["xyz", index: 5, input: "asd78xyzxyzxyzxyz"]</span></div><div class="line">	<span class="comment">//["xyz", index: 8, input: "asd78xyzxyzxyzxyz"]</span></div><div class="line">	<span class="comment">//["xyz", index: 11, input: "asd78xyzxyzxyzxyz"]</span></div><div class="line">&#125;</div><div class="line"><span class="string">``</span><span class="string">`javascript</span></div><div class="line"><span class="string">通过查看index属性可以看到，每次匹配结束后的下一次匹配，是从刚才匹配过的(xyz)结尾的字符开始的（有点绕，实际上第一次匹配，只是确认目标字符串存在指定的那个限定条件，并不影响该限定条件位于的文本参加下一次匹配）。</span></div><div class="line"><span class="string">实际上前查找还有一种写法(?=\d&#123;2&#125;xyz)\d&#123;2&#125;</span></div><div class="line"><span class="string">`</span><span class="string">``</span>javascript</div><div class="line"><span class="keyword">var</span> re = <span class="regexp">/(?=\d&#123;2&#125;xyz)\d&#123;2&#125;/</span>;</div><div class="line"><span class="comment">// 实际上跟/\d&#123;2&#125;(?=xyz)/是等效的</span></div><div class="line"><span class="built_in">console</span>.log(re.exec(<span class="string">"asd78xyz"</span>));<span class="comment">//["78", index: 3, input: "asd78xyz"]</span></div></pre></td></tr></table></figure></p>
<p>看上去这种写法并没有前面那种表达式直白，毕竟前面的写法更能表达“目标表达式后面存在XXX限定条件”的意思。<br>再来一点有意思的：如果要匹配“目标表达式后面不存在XXX限定条件”这样的文本该怎么做呢？只要把”=”换成”!”即可，也就是(?!)：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> re = <span class="regexp">/\d&#123;2&#125;(?!xyz)/</span>;</div><div class="line"><span class="built_in">console</span>.log(re.exec(<span class="string">"asd78aa"</span>));<span class="comment">//["78", index: 3, input: "asd78aa"]</span></div></pre></td></tr></table></figure></p>
<p>只是跟前面的限定条件完全相反，其他是一样的。</p>
<h3 id="后查找"><a href="#后查找" class="headerlink" title="后查找"></a>后查找</h3><p>故名思意，这个捕获需要匹配“其前面存在XXX限定条件的目标表达式”，然而！！！JS并不支持后查找(?&lt;=)，呃，这特么就尴尬了。也许将怎么字符串反转，再将目标表达式反转，然后再使用查找….-_-||好麻烦的样子。<br>上论坛然后有之前的讨论里面提到了<a href="http://blog.stevenlevithan.com/archives/mimic-lookbehind-javascript" target="_blank" rel="external">这篇帖子</a>，用以参考。<br>那么如何实现后查找呢？（待我挖个坑，后面再回来填）。</p>

    </div>
    <footer class="article_ft">
        
        <a href="/tags/正则" class="article_tag">#正则</a>
        
    </footer>

    <div class="article_nav"><a href="/article/mockjs使用心得" class="hover-highlight article_prev">mockjs使用心得</a><a
                href="/article/博客SSR实践总结" class="hover-highlight article_next">博客SSR实践总结</a></div>
</article>
        </div>
    </main>

    <aside>
    <div class="page_sd hide-md">
        <div class="tab">
            <!---->
            
            <ul class="tab_nav">
                <li class="tab_item active" data-target="#J_toc">
                    文章目录
                </li>
                <li class="tab_item" data-target="#J_profile">
                    站点资料
                </li>
            </ul>
            <div class="tab_panel active" id="J_toc">
                <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#exec-方法"><span class="toc-number">1.</span> <span class="toc-text">exec()方法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#捕获"><span class="toc-number">2.</span> <span class="toc-text">捕获</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#定义"><span class="toc-number">2.1.</span> <span class="toc-text">定义</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#非捕获组"><span class="toc-number">2.2.</span> <span class="toc-text">非捕获组</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#前查找"><span class="toc-number">2.3.</span> <span class="toc-text">前查找</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#后查找"><span class="toc-number">2.4.</span> <span class="toc-text">后查找</span></a></li></ol></li></ol>
            </div>
            
            <div class="tab_panel " id="J_profile">
                <div>
                    <div class="me">
                        <img src="http://shymean.com/_nuxt/img/head.dd612ee.jpg" alt="shymean" width="100" height="100">
                        <h3>shymean</h3>
                        <p>一个不学无术且无趣的人。</p>
                    </div>
                    <div class="nav-border">
                        <a href="/book" class="nav_item">
                            <i class="iconfont icon-bookshelf"></i>
                            <br>书架
                        </a>
                        <a href="/message" class="nav_item">
                            <i class="iconfont icon-comment"></i>
                            <br>留言
                        </a>
                        <a href="/about" class="nav_item">
                            <i class="iconfont icon-info"></i>
                            <br>关于
                        </a>
                    </div>
                    <div class="contact">
                        <a href="https://github.com/tangxiangmin" target="_blank" class="contact_link">
                            <i class="iconfont icon-github"></i> GitHub</a>
                        <a href="http://wpa.qq.com/msgrd?v=3&amp;uin=645234650&amp;site=qq&amp;menu=yes"
                            target="_blank" class="contact_link">
                            <i class="iconfont icon-qq"></i> QQ</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="tool">
        <div class="btn-list hide-md" id="J_toggleSide">
            <div class="btn-icon">
                <span class="btn-line"></span>
                <span class="btn-line"></span>
                <span class="btn-line"></span>
            </div>
        </div>
        <div class="btn-top">
            <i class="iconfont icon-top"></i>
        </div>
    </div>
</aside>
    <footer class="page_ft">
    <div class="container footer">
        <p>世人的悲欢并不相通，我只是觉得他们吵闹。</p>
        <p>
            Copyright © Shymean 2016 - 2017
            <a href="http://www.miitbeian.gov.cn" rel="nofollow" target="_blank" style="display:inline-block;">粤ICP备17060238号-1</a>
        </p>
    </div>
    <div class="hide-xs">
        <script src="https://s19.cnzz.com/z_stat.php?id=1264491168&amp;web_id=1264491168" language="JavaScript"></script>
    </div>
</footer>

</div>

</body>
</html>